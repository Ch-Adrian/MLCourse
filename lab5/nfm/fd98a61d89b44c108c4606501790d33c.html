<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>41f537b1b6fe49ab85a4f9466b066567</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div id="47a3df5a-c1d1-4761-a7b5-d5dd6299dd65" class="cell markdown">
<h1 id="neural-forecasting-models">Neural forecasting models</h1>
</div>
<div id="d7117d4f-abdb-4293-98ec-7a20b7124974" class="cell markdown">
<p>We will cover neural models for time series forecasting, both trained
from scratch and pretrained. We will use varied libraries, depending on
the model, for example:</p>
<ul>
<li><a href="https://www.sktime.net/en/stable/index.html">sktime</a> -
general time series processing</li>
<li><a
href="https://github.com/Nixtla/neuralforecast">neuralforecast</a> - a
lot of neural models for time series, e.g. DLinear, N-BEATS</li>
<li><a href="https://pytorch.org/">PyTorch</a> - deep learning
framework</li>
<li><a href="https://github.com/google-research/timesfm">timesfm</a> -
official TimesFM implementation (and loading pretrained model)</li>
</ul>
<p>Use tutorials, quickstarts, GitHub pages etc. of those libraries as
necessary.</p>
</div>
<div id="b5eb88cd" class="cell markdown">

</div>
<div id="0abe2734" class="cell code">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"></code></pre></div>
</div>
<div id="205f46ad-7ea2-4135-b5e1-4d1664890295" class="cell code"
data-execution_count="1">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>warnings.simplefilter(action<span class="op">=</span><span class="st">&quot;ignore&quot;</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>warnings.simplefilter(action<span class="op">=</span><span class="st">&quot;ignore&quot;</span>, category<span class="op">=</span><span class="pp">UserWarning</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span></code></pre></div>
</div>
<div id="0e5963af-1cdb-4999-a8ce-34aa6a414cbd" class="cell markdown">
<h2 id="datasets-and-evaluation">Datasets and evaluation</h2>
</div>
<div id="fbb95b0b-43a2-4a91-a092-45f174041296" class="cell markdown">
<p>We will use 2 datasets:</p>
<ol>
<li><a
href="https://www.sciencedirect.com/science/article/abs/pii/S0957417421005431?via%3Dihub">Italian
pasta dataset</a>, same as in the first notebook.</li>
<li><a
href="https://energy.instrat.pl/en/electrical-system/electricity-production-are/">Polish
energy production data</a>, as published by Energy Instrat and ENTSO-e,
from data by PSE (Polskie Sieci Elektroenergetyczne).</li>
</ol>
<p>Both are multivariate and focused on long-term forecasting.</p>
</div>
<div id="92e32b2f-6f3f-4ed9-b569-4285c387a553" class="cell markdown"
data-jp-MarkdownHeadingCollapsed="true">
<h3 id="italian-pasta">Italian pasta</h3>
</div>
<div id="b11561af-834c-4365-8bf1-5b1d7d0d2bc2" class="cell markdown"
data-jp-MarkdownHeadingCollapsed="true">
<h4 id="data-loading-and-visualization">Data loading and
visualization</h4>
<p>This dataset technically multivariate, but it has data from 4
different companies with very different characteristics, so it may have
pretty weak cross-series dependencies. We will consider a simplified
variant with no exogenous variables.</p>
</div>
<div id="fc668b37-46da-42c1-a223-c9a7f5fbb254" class="cell code"
data-execution_count="2">
<div class="sourceCode" id="cb3"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sktime.utils.plotting <span class="im">import</span> plot_series</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>df_pasta <span class="op">=</span> pd.read_csv(<span class="st">&quot;italian_pasta.csv&quot;</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> num <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]:</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    company_qty_cols <span class="op">=</span> [col <span class="cf">for</span> col <span class="kw">in</span> df_pasta.columns <span class="cf">if</span> col.startswith(<span class="ss">f&quot;QTY_B</span><span class="sc">{</span>num<span class="sc">}</span><span class="ss">&quot;</span>)]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    df_pasta[<span class="ss">f&quot;value_B</span><span class="sc">{</span>num<span class="sc">}</span><span class="ss">&quot;</span>] <span class="op">=</span> df_pasta[company_qty_cols].<span class="bu">sum</span>(axis<span class="op">=</span><span class="st">&quot;columns&quot;</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>df_pasta <span class="op">=</span> df_pasta.set_index(pd.to_datetime(df_pasta[<span class="st">&quot;DATE&quot;</span>])).asfreq(<span class="st">&quot;d&quot;</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>df_pasta <span class="op">=</span> df_pasta[[<span class="st">&quot;value_B1&quot;</span>, <span class="st">&quot;value_B2&quot;</span>, <span class="st">&quot;value_B3&quot;</span>, <span class="st">&quot;value_B4&quot;</span>]]</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>df_pasta</span></code></pre></div>
<div class="output execute_result" data-execution_count="2">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>value_B1</th>
      <th>value_B2</th>
      <th>value_B3</th>
      <th>value_B4</th>
    </tr>
    <tr>
      <th>DATE</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2014-01-02</th>
      <td>101.0</td>
      <td>186.0</td>
      <td>32.0</td>
      <td>36.0</td>
    </tr>
    <tr>
      <th>2014-01-03</th>
      <td>136.0</td>
      <td>248.0</td>
      <td>32.0</td>
      <td>27.0</td>
    </tr>
    <tr>
      <th>2014-01-04</th>
      <td>162.0</td>
      <td>264.0</td>
      <td>94.0</td>
      <td>45.0</td>
    </tr>
    <tr>
      <th>2014-01-05</th>
      <td>106.0</td>
      <td>106.0</td>
      <td>18.0</td>
      <td>29.0</td>
    </tr>
    <tr>
      <th>2014-01-06</th>
      <td>47.0</td>
      <td>54.0</td>
      <td>9.0</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2018-12-27</th>
      <td>203.0</td>
      <td>143.0</td>
      <td>30.0</td>
      <td>39.0</td>
    </tr>
    <tr>
      <th>2018-12-28</th>
      <td>192.0</td>
      <td>187.0</td>
      <td>28.0</td>
      <td>44.0</td>
    </tr>
    <tr>
      <th>2018-12-29</th>
      <td>158.0</td>
      <td>217.0</td>
      <td>44.0</td>
      <td>48.0</td>
    </tr>
    <tr>
      <th>2018-12-30</th>
      <td>182.0</td>
      <td>211.0</td>
      <td>40.0</td>
      <td>27.0</td>
    </tr>
    <tr>
      <th>2018-12-31</th>
      <td>243.0</td>
      <td>206.0</td>
      <td>48.0</td>
      <td>42.0</td>
    </tr>
  </tbody>
</table>
<p>1825 rows × 4 columns</p>
</div>
</div>
</div>
<div id="df71e12f-f1de-4953-8e03-a3800b6b06c7" class="cell code"
data-execution_count="3" data-scrolled="true">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> num <span class="kw">in</span> [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>]:</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    plot_series(df_pasta[<span class="ss">f&quot;value_B</span><span class="sc">{</span>num<span class="sc">}</span><span class="ss">&quot;</span>], title<span class="op">=</span><span class="ss">f&quot;Pasta sales, business </span><span class="sc">{</span>num<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/154d7c2b86090ecf1eb49c72f5f91cdc88833553.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/9064ebaf7543f0d4295f26657faa3ed404066ed3.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/914cdb6a928edb1aaecfcaa464f7d17efb039e90.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/32d9eec3712a1140bff116791764a48ea5f9b053.png" /></p>
</div>
</div>
<div id="381a4102-30db-4afa-9491-389f01f22916" class="cell markdown"
data-jp-MarkdownHeadingCollapsed="true">
<h4 id="evaluation">Evaluation</h4>
<p>Similarly to the first notebook, we will be interested in long-term
forecasting, predicting the daily sales for 2018, based on previous
years. Since we have 4 time series with different scales, MASE is a
great metric, since it can be averaged across series.</p>
</div>
<div id="1a63cbfd-2fe8-40a6-8d14-5af2e3d45bfa" class="cell code"
data-execution_count="4">
<div class="sourceCode" id="cb5"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sktime.transformations.series.impute <span class="im">import</span> Imputer</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>df_pasta_train <span class="op">=</span> df_pasta[df_pasta.index <span class="op">&lt;</span> <span class="st">&quot;2018-01-01&quot;</span>]</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>df_pasta_test <span class="op">=</span> df_pasta[df_pasta.index <span class="op">&gt;=</span> <span class="st">&quot;2018-01-01&quot;</span>]</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>imputer <span class="op">=</span> Imputer(method<span class="op">=</span><span class="st">&quot;ffill&quot;</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>df_pasta_train <span class="op">=</span> imputer.fit_transform(df_pasta_train)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>df_pasta_test <span class="op">=</span> imputer.transform(df_pasta_test)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Data size: train </span><span class="sc">{</span><span class="bu">len</span>(df_pasta_train)<span class="sc">}</span><span class="ss">, test </span><span class="sc">{</span><span class="bu">len</span>(df_pasta_test)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Data size: train 1460, test 365
</code></pre>
</div>
</div>
<div id="a9582771-e343-4ad5-b8fd-612ae29d7a37" class="cell markdown"
data-jp-MarkdownHeadingCollapsed="true">
<h3 id="polish-energy-production">Polish energy production</h3>
</div>
<div id="5cf64d1f-8a6a-4eeb-9610-f7dfeeeb13ec" class="cell markdown">
<h4 id="data-loading-and-visualization">Data loading and
visualization</h4>
<p>Energy mix is composed of multiple energy sources. It typically
consists of multiple components:</p>
<ul>
<li>slow-changing base, e.g. coal, nuclear</li>
<li>faster changing and controllable sources, e.g. gas, oil, hydro</li>
<li>very cheap, but uncontrollably changing renewables, e.g. wind,
solar</li>
</ul>
<p>The resulting production is always limited by the grid efficiency,
which is very low in Poland, resulting in e.g. refusing to connect more
prosumer solar installations. As such, the production limits are
monitored and controlled, and cross-series dependencies are often quite
strong.</p>
<p>We will aggregate the energy sources a bit, and consider:</p>
<ul>
<li>coal (and derivatives)</li>
<li>hydro (from all sources)</li>
<li>solar</li>
<li>wind</li>
<li>all others, e.g. oil (petroleum), biomass</li>
</ul>
<p>Since units are GWh (10^9 Wh, Whatt hours), values are very high, so
we will consider thousands of GWh, i.e. TWh (10^12 Wh). It is not a
standard unit, but should help with numerical stability for methods that
do not perform standardization or scaling.</p>
<p>Data from PSE has changed its format and processing at 13.06.2024,
and values since this date are in 15-minutes intervals, compared to
1-hour from before. As such, we divide them by 4, to have the same
unit.</p>
<p>If you want to know more about energy production and demand, see e.g.
<a href="https://www.youtube.com/watch?v=xhxo2oXRiio">this video</a> or
<a href="https://www.youtube.com/watch?v=GBp_NgrrtPM">this
video</a>.</p>
</div>
<div id="8e193357-c7ef-4062-8ac3-d69021179032" class="cell code"
data-execution_count="5" data-scrolled="true">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df_energy <span class="op">=</span> pd.read_csv(<span class="st">&quot;electricity_production_entsoe_all.csv&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df_energy <span class="op">=</span> df_energy.drop(columns<span class="op">=</span><span class="st">&quot;date_utc&quot;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>df_energy[<span class="st">&quot;date&quot;</span>] <span class="op">=</span> pd.to_datetime(df_energy[<span class="st">&quot;date&quot;</span>], <span class="bu">format</span><span class="op">=</span><span class="st">&quot;</span><span class="sc">%d</span><span class="st">.%m.%Y %H:%M&quot;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>df_energy <span class="op">=</span> df_energy.set_index(<span class="st">&quot;date&quot;</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>df_energy <span class="op">=</span> df_energy.resample(<span class="st">&quot;D&quot;</span>).<span class="bu">sum</span>()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate energy sources</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>df_energy[<span class="st">&quot;coal&quot;</span>] <span class="op">=</span> (</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>    df_energy[<span class="st">&quot;hard_coal&quot;</span>] <span class="op">+</span> df_energy[<span class="st">&quot;coal-derived&quot;</span>] <span class="op">+</span> df_energy[<span class="st">&quot;lignite&quot;</span>]</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>df_energy[<span class="st">&quot;hydro&quot;</span>] <span class="op">=</span> (</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    df_energy[<span class="st">&quot;hydro_pumped_storage&quot;</span>] <span class="op">+</span> </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    df_energy[<span class="st">&quot;hydro_run-of-river_and_poundage&quot;</span>] <span class="op">+</span> </span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>    df_energy[<span class="st">&quot;hydro_water_reservoir&quot;</span>]</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>df_energy[<span class="st">&quot;wind&quot;</span>] <span class="op">=</span> df_energy[<span class="st">&quot;wind_onshore&quot;</span>]</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>df_energy[<span class="st">&quot;other&quot;</span>] <span class="op">=</span> (</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    df_energy[<span class="st">&quot;oil&quot;</span>] <span class="op">+</span> </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>    df_energy[<span class="st">&quot;biomass&quot;</span>] <span class="op">+</span> </span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    df_energy[<span class="st">&quot;other&quot;</span>] <span class="op">+</span> </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>    df_energy[<span class="st">&quot;other_renewable&quot;</span>]</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>df_energy <span class="op">=</span> df_energy[[<span class="st">&quot;coal&quot;</span>, <span class="st">&quot;gas&quot;</span>, <span class="st">&quot;hydro&quot;</span>, <span class="st">&quot;wind&quot;</span>, <span class="st">&quot;solar&quot;</span>, <span class="st">&quot;other&quot;</span>]]</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># fix values and change units (GWh -&gt; thousands of GWh)</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>df_energy[df_energy.index <span class="op">&gt;=</span> <span class="st">&quot;13.06.2024&quot;</span>] <span class="op">/=</span> <span class="dv">4</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>df_energy[<span class="st">&quot;other&quot;</span>][df_energy.index <span class="op">&gt;=</span> <span class="st">&quot;13.06.2024&quot;</span>] <span class="op">/=</span> <span class="dv">2</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>df_energy <span class="op">=</span> df_energy <span class="op">/</span> <span class="dv">1000</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>df_energy</span></code></pre></div>
<div class="output execute_result" data-execution_count="5">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>coal</th>
      <th>gas</th>
      <th>hydro</th>
      <th>wind</th>
      <th>solar</th>
      <th>other</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2015-01-02</th>
      <td>298.90400</td>
      <td>10.13800</td>
      <td>9.25500</td>
      <td>77.61100</td>
      <td>0.0000</td>
      <td>5.702000</td>
    </tr>
    <tr>
      <th>2015-01-03</th>
      <td>288.79200</td>
      <td>10.25900</td>
      <td>9.30400</td>
      <td>80.98500</td>
      <td>0.0000</td>
      <td>5.155000</td>
    </tr>
    <tr>
      <th>2015-01-04</th>
      <td>271.66200</td>
      <td>9.89600</td>
      <td>7.83800</td>
      <td>77.09600</td>
      <td>0.0000</td>
      <td>4.175000</td>
    </tr>
    <tr>
      <th>2015-01-05</th>
      <td>367.48300</td>
      <td>10.03000</td>
      <td>7.09000</td>
      <td>43.30900</td>
      <td>0.0000</td>
      <td>5.627000</td>
    </tr>
    <tr>
      <th>2015-01-06</th>
      <td>343.57200</td>
      <td>10.26700</td>
      <td>7.06800</td>
      <td>18.49900</td>
      <td>0.0000</td>
      <td>5.631000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2024-10-30</th>
      <td>272.83625</td>
      <td>68.80675</td>
      <td>4.48175</td>
      <td>87.23000</td>
      <td>13.5885</td>
      <td>16.192750</td>
    </tr>
    <tr>
      <th>2024-10-31</th>
      <td>252.18300</td>
      <td>60.90650</td>
      <td>4.63500</td>
      <td>111.13200</td>
      <td>20.7190</td>
      <td>16.189625</td>
    </tr>
    <tr>
      <th>2024-11-01</th>
      <td>158.76150</td>
      <td>43.92125</td>
      <td>5.50675</td>
      <td>169.88575</td>
      <td>23.0975</td>
      <td>14.869250</td>
    </tr>
    <tr>
      <th>2024-11-02</th>
      <td>190.79925</td>
      <td>47.28800</td>
      <td>5.18575</td>
      <td>88.41450</td>
      <td>45.9005</td>
      <td>15.769750</td>
    </tr>
    <tr>
      <th>2024-11-03</th>
      <td>138.62925</td>
      <td>38.76325</td>
      <td>3.76750</td>
      <td>71.03375</td>
      <td>32.5945</td>
      <td>11.860500</td>
    </tr>
  </tbody>
</table>
<p>3594 rows × 6 columns</p>
</div>
</div>
</div>
<div id="cdbd4e2b-78b8-462f-be47-554cdd3ad48b" class="cell code"
data-execution_count="6" data-scrolled="true">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>plot_series(df_energy.<span class="bu">sum</span>(axis<span class="op">=</span><span class="st">&quot;columns&quot;</span>), title<span class="op">=</span><span class="ss">f&quot;Total energy production&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> df_energy.columns:</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    plot_series(df_energy[col], title<span class="op">=</span><span class="ss">f&quot;</span><span class="sc">{</span>col<span class="sc">.</span>capitalize()<span class="sc">}</span><span class="ss"> energy production&quot;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/c5a9098f1f433013fb40a86010dff74f674388a1.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/e1d0650e1649ad74980e3b6a670abe163240201c.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/aaa9affbbae9d565b4ca3420eae398aa839c35fc.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/cffc992e5d58942c2f1963328078a598931dba34.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/19c60c580eabe0e2a1a192506f7fdf5f43cbd39e.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/44c63c6983912ec2aa876d7cb2f4439ea2232fd2.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/71ea4c1a1809f7a3ac33758c6db6a78959bb8e38.png" /></p>
</div>
</div>
<div id="3fdcc2a0-ad9e-4124-8bec-6a0195c6c07e" class="cell markdown">
<h4 id="evaluation">Evaluation</h4>
<p>We will perform long-term forecasting, which is a common task on
energy production and demand datasets. We will predict production for
2024, using MASE metric.</p>
</div>
<div id="9525b041-1915-4cc0-bab9-55fa612b1839" class="cell code"
data-execution_count="7">
<div class="sourceCode" id="cb9"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sktime.transformations.series.impute <span class="im">import</span> Imputer</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>df_energy_train <span class="op">=</span> df_energy[df_energy.index <span class="op">&lt;</span> <span class="st">&quot;2024-01-01&quot;</span>]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>df_energy_test <span class="op">=</span> df_energy[df_energy.index <span class="op">&gt;=</span> <span class="st">&quot;2024-01-01&quot;</span>]</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f&quot;Data size: train </span><span class="sc">{</span><span class="bu">len</span>(df_energy_train)<span class="sc">}</span><span class="ss">, test </span><span class="sc">{</span><span class="bu">len</span>(df_energy_test)<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Data size: train 3286, test 308
</code></pre>
</div>
</div>
<div id="99585bab-4ef9-4e38-9826-b154201b5e8c" class="cell markdown">
<h2 id="forecasting">Forecasting</h2>
</div>
<div id="3c1eb62f-49a2-4e75-b784-48b9cb95fe71" class="cell markdown">
<p>The sub-sections are independent, and can be implemented in any
order. The more you do, the more points (and hence the higher mark) you
get. They are also more freeform than previous notebook, and there are
more options to choose from.</p>
<p>When tuning hyperparameters, choose any strategy you think is
reasonable, taking into consideration computational cost and model
complexity. Temporal train-valid-test split, time split CV, expanding
window - your choice. Even manual tuning is ok, if you think it makes
sense, but remember to use the validation set.</p>
<p>You can use any framework and tool you want, but suggestions are
provided in further sections. Install additional dependencies as needed,
either using Poetry and recreating <code>poetry lock</code>, or by
directly using <code>!pip install ...</code>.</p>
<p>Training and evaluating more models from particular category can get
you more points, as described below. If you prefer, you can also
experiment with other models, e.g. RNNs, CNN-based, or state-space
models (SSMs), adding further sections. Each one by default is worth 2
points.</p>
<p><strong>Warning:</strong> when making this notebook, some errors with
<code>neuralforecast</code> cropped up when horizon was greater than 292
for Italian pasta dataset. You can cut the test set at 292 if
necessary.</p>
</div>
<div id="a5c940ad-8e84-4ad1-9853-9b66e70ccaf0" class="cell markdown">
<p>Note that some frameworks (e.g. <code>neuralforecast</code>) require
"tall"/"long" time series representation, with columns:
<code>unique_id</code> (time series identifier), <code>ds</code> (date)
and <code>y</code> (actual value). This is in contrast to the "wide"
representation, where we have individual series in separate columns,
each row with separate date, and values in cells. See e.g. <a
href="https://nixtlaverse.nixtla.io/neuralforecast/docs/getting-started/quickstart.html#2-loading-airpassengers-data">neuralforecast
quickstart</a> for an example. Functions prepared below may be
useful.</p>
</div>
<div id="73cca2b1-a550-4f3a-90e3-3716e469b238" class="cell code"
data-execution_count="8">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Optional</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> wide_to_long_df(df: pd.DataFrame) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.melt(df, ignore_index<span class="op">=</span><span class="va">False</span>).reset_index(names<span class="op">=</span><span class="st">&quot;date&quot;</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.rename(columns<span class="op">=</span>{<span class="st">&quot;variable&quot;</span>: <span class="st">&quot;unique_id&quot;</span>, <span class="st">&quot;date&quot;</span>: <span class="st">&quot;ds&quot;</span>, <span class="st">&quot;value&quot;</span>: <span class="st">&quot;y&quot;</span>})</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> long_to_wide_df(df: pd.DataFrame, values_col: Optional[<span class="bu">str</span>] <span class="op">=</span> <span class="va">None</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">&quot;unique_id&quot;</span> <span class="kw">not</span> <span class="kw">in</span> df.columns:</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.reset_index(names<span class="op">=</span><span class="st">&quot;unique_id&quot;</span>)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    values_col <span class="op">=</span> values_col <span class="cf">if</span> values_col <span class="cf">else</span> df.columns[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.pivot(df, columns<span class="op">=</span><span class="st">&quot;unique_id&quot;</span>, index<span class="op">=</span><span class="st">&quot;ds&quot;</span>, values<span class="op">=</span>values_col)</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span></code></pre></div>
</div>
<div id="616b78fc-6204-4c46-81b7-ab9df1e076df" class="cell markdown">
<h3 id="baselines-2-points">Baselines (2 points)</h3>
</div>
<div id="82449869-eefe-4506-8191-c1ba2b37f7d6" class="cell markdown">
<p>Implement baselines for neural models:</p>
<ul>
<li>last value (naive)</li>
<li>average</li>
<li>AutoARIMA</li>
<li>AutoETS (with damped trend)</li>
</ul>
<p>Each dataset is worth 1 point. <code>sktime</code> will be
useful.</p>
</div>
<div id="94c59ff3" class="cell code" data-execution_count="9">
<div class="sourceCode" id="cb12"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df_energy_train_long <span class="op">=</span> df_energy_train.copy()</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df_energy_test_long <span class="op">=</span> df_energy_test.copy()</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># df_energy_train_long = wide_to_long_df(df_energy_train_long)</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_energy_train_long.head())</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>df_energy_train_long <span class="op">=</span> df_energy_train_long.loc[:,[<span class="st">&quot;coal&quot;</span>, <span class="st">&quot;gas&quot;</span>, <span class="st">&quot;hydro&quot;</span>, <span class="st">&quot;wind&quot;</span>, <span class="st">&quot;solar&quot;</span>, <span class="st">&quot;other&quot;</span>]]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>df_energy_test_long <span class="op">=</span> df_energy_test_long.loc[:,[<span class="st">&quot;coal&quot;</span>, <span class="st">&quot;gas&quot;</span>, <span class="st">&quot;hydro&quot;</span>, <span class="st">&quot;wind&quot;</span>, <span class="st">&quot;solar&quot;</span>, <span class="st">&quot;other&quot;</span>]]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>df_energy_train_long_coal <span class="op">=</span> df_energy_train_long.loc[:,[<span class="st">&quot;coal&quot;</span>]]</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>df_energy_test_long_coal <span class="op">=</span> df_energy_test_long.loc[:,[<span class="st">&quot;coal&quot;</span>]]</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>df_energy_train_long_coal <span class="op">=</span> df_energy_train_long_coal[<span class="st">&#39;coal&#39;</span>]</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>df_energy_test_long_coal <span class="op">=</span> df_energy_test_long_coal[<span class="st">&quot;coal&quot;</span>]</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="co"># print(df_energy_train_long_coal)</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_data_for(label):</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    df_train <span class="op">=</span> df_energy_train_long.loc[:,[label]]</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    df_test <span class="op">=</span> df_energy_test_long.loc[:,[label]]</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df_train[label], df_test[label]</span></code></pre></div>
</div>
<div id="ee19400e" class="cell code" data-execution_count="10">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_multi_series(data, y_pred, labels):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    y_true <span class="op">=</span> data.loc[y_pred.index]</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> label <span class="kw">in</span> labels:</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>        data_series <span class="op">=</span> data[label]</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>        y_pred_series <span class="op">=</span> y_pred[label]</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>        plot_series(data_series, y_pred_series, labels<span class="op">=</span>[<span class="st">&quot;y&quot;</span>, <span class="st">&quot;y_pred&quot;</span>])</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>        plt.clf()</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_multi_series(data, residuals, labels):</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> label <span class="kw">in</span> labels:</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>        residuals_series <span class="op">=</span> residuals[label]</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>        anderson_test <span class="op">=</span> anderson(residuals_series)</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Anderson-Darling test: </span><span class="sc">{</span>anderson_test<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;=========================================&quot;</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>        ljung_box_test <span class="op">=</span> acorr_ljungbox(residuals_series, lags<span class="op">=</span>[<span class="dv">12</span>], return_df<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Ljung-Box test: </span><span class="sc">{</span>ljung_box_test<span class="sc">}</span><span class="ss">&quot;</span>)</span></code></pre></div>
</div>
<div id="055f3e85-6925-4bdb-9fd6-25dce7cc2f44" class="cell code"
data-execution_count="11">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> anderson</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sktime.forecasting.model_evaluation <span class="im">import</span> evaluate</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sktime.performance_metrics.forecasting <span class="im">import</span> (</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    MeanAbsoluteScaledError,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    MeanAbsoluteError,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    MeanAbsolutePercentageError,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sktime.forecasting.model_selection <span class="im">import</span> ExpandingWindowSplitter</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.stats.diagnostic <span class="im">import</span> acorr_ljungbox</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_model(</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    model,</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>    data: pd.Series,</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    horizon: <span class="bu">int</span> <span class="op">=</span> <span class="dv">1</span>,</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    plot_forecasts: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    analyze_residuals: <span class="bu">bool</span> <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    cv <span class="op">=</span> ExpandingWindowSplitter(fh<span class="op">=</span>np.arange(<span class="dv">1</span>, horizon<span class="op">+</span><span class="dv">1</span>), initial_window<span class="op">=</span><span class="bu">int</span>(<span class="bu">len</span>(data)<span class="op">-</span>horizon), step_length<span class="op">=</span>horizon)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>    metrics <span class="op">=</span> [MeanAbsoluteError(), MeanAbsoluteScaledError(), MeanAbsolutePercentageError()]</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> evaluate(model, cv, data, scoring<span class="op">=</span>metrics, return_data<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>    mae <span class="op">=</span> <span class="bu">round</span>(np.mean(results[<span class="st">&quot;test_MeanAbsoluteError&quot;</span>]), <span class="dv">2</span>)</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>    mase <span class="op">=</span> <span class="bu">round</span>(np.mean(results[<span class="st">&quot;test_MeanAbsoluteScaledError&quot;</span>]), <span class="dv">2</span>)</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;MAE: </span><span class="sc">{</span>mae<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f&quot;MASE: </span><span class="sc">{</span>mase<span class="sc">:.2f}</span><span class="ss">&quot;</span>)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> pd.concat(results[<span class="st">&quot;y_pred&quot;</span>].values)</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> y_pred.sort_index()</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> plot_forecasts:</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>        plot_multi_series(data, y_pred, data.columns)</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> analyze_residuals:</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>        y_true <span class="op">=</span> data.loc[y_pred.index]</span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>        residuals <span class="op">=</span> y_true <span class="op">-</span> y_pred</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>        residuals.hist(bins<span class="op">=</span><span class="dv">20</span>)</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">&quot;Histogram of residuals&quot;</span>)</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>        test_multi_series(data, residuals, data.columns)</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>        </span></code></pre></div>
</div>
<div id="4dd6f1dd" class="cell code" data-execution_count="12">
<div class="sourceCode" id="cb15"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sktime.forecasting.naive <span class="im">import</span> NaiveForecaster</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sktime.forecasting.base <span class="im">import</span> ForecastingHorizon</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sktime.forecasting.statsforecast <span class="im">import</span> StatsForecastAutoETS, StatsForecastAutoARIMA</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> forecast_for_df(df_train, df_test):</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    day_period <span class="op">=</span> <span class="bu">len</span>(df_test)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Naive forecast: last&quot;</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    model_naive <span class="op">=</span> NaiveForecaster(strategy<span class="op">=</span><span class="st">&quot;last&quot;</span>, sp<span class="op">=</span><span class="dv">365</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    evaluate_model(model_naive, df_train, horizon<span class="op">=</span>day_period, plot_forecasts<span class="op">=</span><span class="va">True</span>, analyze_residuals<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Naive forecast: mean&quot;</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    model_mean <span class="op">=</span> NaiveForecaster(strategy<span class="op">=</span><span class="st">&quot;mean&quot;</span>, sp<span class="op">=</span><span class="dv">365</span>)</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    evaluate_model(model_mean, df_train, horizon<span class="op">=</span>day_period, plot_forecasts<span class="op">=</span><span class="va">True</span>, analyze_residuals<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;AutoARIMA:&quot;</span>)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    model_arima <span class="op">=</span> StatsForecastAutoARIMA(sp<span class="op">=</span><span class="dv">31</span>)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    evaluate_model(model_arima, df_train, horizon<span class="op">=</span>day_period, plot_forecasts<span class="op">=</span><span class="va">True</span>, analyze_residuals<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;AutoETS:&quot;</span>)</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    model_ets <span class="op">=</span> StatsForecastAutoETS(damped<span class="op">=</span><span class="va">True</span>, season_length<span class="op">=</span><span class="dv">365</span>)</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    evaluate_model(model_ets, df_train, horizon<span class="op">=</span>day_period, plot_forecasts<span class="op">=</span><span class="va">True</span>, analyze_residuals<span class="op">=</span><span class="va">True</span>)</span></code></pre></div>
</div>
<div id="20f84d93" class="cell code" data-execution_count="13">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>forecast_for_df(df_energy_train, df_energy_test)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Naive forecast: last
MAE: 23.78
MASE: 2.63
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/2f5c46b3df93e39ee4c410d8d7f058a5859296c5.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/adf23d34baf85bcd4ce7852d8852574079cda590.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/05de3de2ff5e7f44b0b608628eec28952d04b3f3.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/643c0a900753e4bfefde88a456ac0b563f719e7d.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/b55efb1e466ea9268a6eae4e6b6884237bf9466d.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/05b3eab7544482e4050aa457ab16ac2fb28d396b.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/8c550bd522889282f4170cd2c6318a421b4894ed.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>Anderson-Darling test: AndersonResult(statistic=0.511819933572724, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-65.71621753246754, scale=52.282421737559716)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat     lb_pvalue
12  161.944158  2.109034e-28
Anderson-Darling test: AndersonResult(statistic=0.7782673101467594, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=10.17426948051948, scale=9.056956661206584)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:       lb_stat      lb_pvalue
12  934.17814  2.619844e-192
Anderson-Darling test: AndersonResult(statistic=0.39189552596758404, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=2.3150551948051947, scale=2.2387767585879956)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat     lb_pvalue
12  491.579203  1.372326e-97
Anderson-Darling test: AndersonResult(statistic=1.3583081893484064, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=12.33630844155844, scale=48.28921280366573)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat     lb_pvalue
12  178.239919  9.798592e-32
Anderson-Darling test: AndersonResult(statistic=2.0683212393437316, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=12.083305194805193, scale=16.82985551480534)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:       lb_stat     lb_pvalue
12  303.36883  9.210358e-58
Anderson-Darling test: AndersonResult(statistic=5.2314094064109895, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=2.544126623376623, scale=2.687667461678576)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:         lb_stat  lb_pvalue
12  2012.264818        0.0
Naive forecast: mean
MAE: 25.57
MASE: 2.83
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/85749410716f181279ddd9552f5e3ceee2639a89.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/8e59ef0f53bf8c3ef24b72cac902e8e13d0c492b.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/fdb01eaf960283e1067173198acc26650e40b7b7.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/c8050a25dece4a9dfed974e53ea5da68abdc1511.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/58ca11b0eaae0c7b9145c4ca446e55035c3e5464.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/8902ea31d83d797e6ba4eb9741bf05981d186a8c.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/9068421735d6c291ff864e4f96e4396552412681.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>Anderson-Darling test: AndersonResult(statistic=0.20441094095303924, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-66.90082557720056, scale=41.52517445445183)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat     lb_pvalue
12  273.782097  1.471309e-51
Anderson-Darling test: AndersonResult(statistic=0.4743681161717177, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=10.312511093073592, scale=8.54489120914126)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:         lb_stat  lb_pvalue
12  1711.863171        0.0
Anderson-Darling test: AndersonResult(statistic=0.30412924596129187, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=2.799301271645022, scale=1.6337874827521062)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:      lb_stat     lb_pvalue
12  420.4998  1.716043e-82
Anderson-Darling test: AndersonResult(statistic=6.319366261582616, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=20.297529401154403, scale=39.47947224513923)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat     lb_pvalue
12  213.414763  5.495414e-39
Anderson-Darling test: AndersonResult(statistic=4.056286172489763, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=34.899965413059164, scale=21.21695492655465)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:         lb_stat  lb_pvalue
12  1673.067231        0.0
Anderson-Darling test: AndersonResult(statistic=10.126189914846009, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=3.1776103445165944, scale=1.964622988777714)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:         lb_stat  lb_pvalue
12  1508.211137        0.0
AutoARIMA:
MAE: 24.22
MASE: 2.68
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/36b94764eb14249d0d3909b2fa2670e945bc6eb5.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/45dc9fd6e500d788338d5fb8c42445762383f360.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/43aede33614adfd85fe7ea290a7a2d28a8737d62.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/91e06ac2684d17cda0a34328a26bfc32ca8bc060.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/d4a7df04393fc09aeb09c4fdd28da652606e7bbf.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/98b651e2ca482a0c0dfaaa20c251ee425e21785f.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/91c9bde07fd248a0d6e741016baa465d2470703b.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>Anderson-Darling test: AndersonResult(statistic=0.8402534968523128, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-48.638344471488985, scale=50.44294337135307)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat      lb_pvalue
12  697.204648  1.748479e-141
Anderson-Darling test: AndersonResult(statistic=1.1386385428876338, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-0.6574363398158227, scale=10.893194651406052)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:         lb_stat  lb_pvalue
12  2307.689015        0.0
Anderson-Darling test: AndersonResult(statistic=2.1885943270104917, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-3.130824356596373, scale=2.282156071615887)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:         lb_stat  lb_pvalue
12  1519.503053        0.0
Anderson-Darling test: AndersonResult(statistic=10.844515066034035, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-22.959594878883816, scale=42.411378158751255)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat     lb_pvalue
12  443.302466  2.495314e-87
Anderson-Darling test: AndersonResult(statistic=4.198521184291508, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=26.74094005287989, scale=23.47587941091983)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:         lb_stat  lb_pvalue
12  1946.635315        0.0
Anderson-Darling test: AndersonResult(statistic=7.473601534088857, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-1.0969643617330722, scale=2.1204899061238054)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:         lb_stat  lb_pvalue
12  1873.087812        0.0
AutoETS:
MAE: 22.54
MASE: 2.49
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/b6034e688fa1ad4931da5b85a47fd3f742f45c79.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/7ba742353a9fc76c30cc11fed4069154308ed096.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/a311d54b32d87440ef72c4c7c909fd7fdf3161df.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/4dba39a8c114314f651f984cbd9ca24e8a8b2187.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/0f1746b03ef3aaf6baaab8d10a94a00adf888af0.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/6532d38ef393248c8b8166c05c7cbc63b2629268.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/f081722ab7f07d4abcc7f08c80e71f91f7fbfb5e.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>Anderson-Darling test: AndersonResult(statistic=0.8624884375002466, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-18.472573647051668, scale=50.56114274922523)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat      lb_pvalue
12  698.269407  1.034558e-141
Anderson-Darling test: AndersonResult(statistic=1.0017465569684987, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=5.918572104324896, scale=10.793412036312583)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:         lb_stat  lb_pvalue
12  2316.548681        0.0
Anderson-Darling test: AndersonResult(statistic=2.20254853575193, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-3.2080552700734777, scale=2.2861234049687864)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:         lb_stat  lb_pvalue
12  1520.031798        0.0
Anderson-Darling test: AndersonResult(statistic=10.682690507860286, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-29.997690335248883, scale=42.41797835716869)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat     lb_pvalue
12  442.572271  3.565510e-87
Anderson-Darling test: AndersonResult(statistic=4.2320157884203695, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=27.365031824757423, scale=23.49730114384779)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:         lb_stat  lb_pvalue
12  1949.429676        0.0
Anderson-Darling test: AndersonResult(statistic=5.8413783978087395, critical_values=array([0.569, 0.648, 0.777, 0.906, 1.078]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-1.6337338723019517, scale=2.245467555121228)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:         lb_stat  lb_pvalue
12  2013.588865        0.0
</code></pre>
</div>
</div>
<div id="c9b65741" class="cell code" data-execution_count="14">
<div class="sourceCode" id="cb46"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>forecast_for_df(df_pasta_train, df_pasta_test)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Naive forecast: last
MAE: 65.49
MASE: 1.49
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/b0c9a8f9880736614fc228ac6942b47bb1e916b2.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/a5813bdc640f19f0174c149452b8d1ae09ac5bea.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/b675849d8d119a0b20c99583bb371000d67ccd02.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/48baa89eb97995de5ee24bdb372045145fa85b1a.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/d6be47ca4aecebe32ec54d66f8d85f83837a5f4b.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>Anderson-Darling test: AndersonResult(statistic=8.436174153820787, critical_values=array([0.57 , 0.649, 0.779, 0.908, 1.08 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-25.312328767123287, scale=143.35367385987144)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat     lb_pvalue
12  343.114171  3.974979e-66
Anderson-Darling test: AndersonResult(statistic=6.779722953294254, critical_values=array([0.57 , 0.649, 0.779, 0.908, 1.08 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=1.4136986301369863, scale=77.10583085922454)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat     lb_pvalue
12  186.807565  1.704182e-33
Anderson-Darling test: AndersonResult(statistic=39.577212193961145, critical_values=array([0.57 , 0.649, 0.779, 0.908, 1.08 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-11.331506849315069, scale=93.60568581383939)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat      lb_pvalue
12  687.232306  2.381960e-139
Anderson-Darling test: AndersonResult(statistic=47.8904331726676, critical_values=array([0.57 , 0.649, 0.779, 0.908, 1.08 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=10.265753424657534, scale=130.67259671691394)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:       lb_stat     lb_pvalue
12  486.29679  1.824548e-96
Naive forecast: mean
MAE: 64.49
MASE: 1.47
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/31fc449837f5d69cb14bcccbb1ba0974e621aece.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/b14cbf7c424d1335fb5bfc49a86ffa0ac93c780e.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/83c8c050c8f9548f7f90d95284b1a9143a67532e.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/44bc0fab18351602b64a3961d0d5cac85e14193d.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/b33557afda9adb42e99845206c0da2cb102ccfb6.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>Anderson-Darling test: AndersonResult(statistic=3.519166278207649, critical_values=array([0.57 , 0.649, 0.779, 0.908, 1.08 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-18.263926940639273, scale=123.14519133430032)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat     lb_pvalue
12  347.343416  5.098132e-67
Anderson-Darling test: AndersonResult(statistic=0.49906156563633886, critical_values=array([0.57 , 0.649, 0.779, 0.908, 1.08 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-10.548858447488584, scale=69.54832344728518)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat     lb_pvalue
12  292.045321  2.193350e-55
Anderson-Darling test: AndersonResult(statistic=18.787148576226855, critical_values=array([0.57 , 0.649, 0.779, 0.908, 1.08 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-15.882191780821918, scale=72.9654220217475)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat      lb_pvalue
12  764.269552  7.561045e-156
Anderson-Darling test: AndersonResult(statistic=37.223372994279316, critical_values=array([0.57 , 0.649, 0.779, 0.908, 1.08 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=5.59269406392694, scale=120.7773143162091)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat      lb_pvalue
12  612.655155  2.101339e-123
AutoARIMA:
MAE: 59.37
MASE: 1.35
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/a223d2db32134eb82823dc53a8d4de83b114e070.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/1bca97be775de025fd762b9dceec7072e922312e.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/00eb64bff029a23280e8f467496af6ed7b3f41bf.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/87d8728a0dad2270ab01eb4cb1f126e10d5db537.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/fa30a2f29f7d664cb8e1b640253a91dcf01c7685.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>Anderson-Darling test: AndersonResult(statistic=17.91134725157383, critical_values=array([0.57 , 0.649, 0.779, 0.908, 1.08 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-17.852034037482845, scale=102.51249127636963)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat     lb_pvalue
12  470.596711  3.975788e-93
Anderson-Darling test: AndersonResult(statistic=6.527086148618821, critical_values=array([0.57 , 0.649, 0.779, 0.908, 1.08 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-24.734371395356845, scale=55.77113433603761)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat     lb_pvalue
12  191.502594  1.842113e-34
Anderson-Darling test: AndersonResult(statistic=59.22293232563845, critical_values=array([0.57 , 0.649, 0.779, 0.908, 1.08 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-18.153674584500504, scale=52.92303333312919)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat      lb_pvalue
12  816.046841  5.987778e-167
Anderson-Darling test: AndersonResult(statistic=76.70645142914668, critical_values=array([0.57 , 0.649, 0.779, 0.908, 1.08 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=6.042803950801372, scale=109.4517185341545)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat      lb_pvalue
12  636.955174  1.348978e-128
AutoETS:
MAE: 94.69
MASE: 2.16
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/63058ac53a0dcd0c26ff16737c7c5ddfa713e0dd.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/1843c197d0a3fdb352912ee05c737c3d11762c3a.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/a4b9e93d3c6681dbce5b0d5af2c2f7278b8a3571.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/d944e5d95047345dd203d4774e0a94d38745b043.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/ed3ab22b5ca80c45bd3aa01c9fe892428c95b388.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>Anderson-Darling test: AndersonResult(statistic=18.078099691953184, critical_values=array([0.57 , 0.649, 0.779, 0.908, 1.08 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-8.771437425448973, scale=102.6351424531269)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat     lb_pvalue
12  472.903575  1.285485e-93
Anderson-Darling test: AndersonResult(statistic=6.738003682103226, critical_values=array([0.57 , 0.649, 0.779, 0.908, 1.08 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-39.91391248330254, scale=55.92104768185974)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat     lb_pvalue
12  198.268819  7.424210e-36
Anderson-Darling test: AndersonResult(statistic=61.087683543010485, critical_values=array([0.57 , 0.649, 0.779, 0.908, 1.08 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=-190.0541195718263, scale=54.14345661330877)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat      lb_pvalue
12  749.739885  9.819517e-153
Anderson-Darling test: AndersonResult(statistic=77.20803842700639, critical_values=array([0.57 , 0.649, 0.779, 0.908, 1.08 ]), significance_level=array([15. , 10. ,  5. ,  2.5,  1. ]), fit_result=  params: FitParams(loc=34.59581354358375, scale=109.53441121588388)
 success: True
 message: &#39;`anderson` successfully fit the distribution to the data.&#39;)
=========================================
Ljung-Box test:        lb_stat      lb_pvalue
12  638.016842  7.999661e-129
</code></pre>
</div>
</div>
<div id="7e49d112-b931-4645-abf7-dc12f47314c5" class="cell markdown">
<h3 id="linear-models-2-points">Linear models (2 points)</h3>
</div>
<div id="b08d6227-3bf0-4783-a3c8-4e51006585d6" class="cell markdown">
<p>Implement linear neural models:</p>
<ul>
<li>multioutput linear regression</li>
<li>LTSF Linear</li>
<li>LTSF DLinear</li>
<li>LTSF NLinear</li>
</ul>
<p>Note that Linear is a multi-channel model, while multioutput linear
regression is single-channel.</p>
<p>Tune the lookback window, the only hyperparameter of those models, or
justify your choice in a comment if you don't. You can check the papers
for reasonable values.</p>
<p>If you use a given model, train it on both datasets. Each model is
worth 0.5 points. Useful libraries: <code>sktime</code>,
<code>neuralforecast</code>, PyTorch.</p>
<p>Useful references:</p>
<ul>
<li><a href="https://arxiv.org/abs/2205.13504">"Are Transformers
Effective for Time Series Forecasting?" A. Zeng et al.</a> (<a
href="https://github.com/cure-lab/LTSF-Linear">GitHub code</a>)</li>
<li><a href="https://arxiv.org/abs/2403.14587">"An Analysis of Linear
Time Series Forecasting Models" W.Toner, L. Darlow</a> (<a
href="https://github.com/sir-lab/linear-forecasting">GitHub
code</a>)</li>
</ul>
</div>
<div id="2b3d4109" class="cell code" data-execution_count="15">
<div class="sourceCode" id="cb68"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sktime.forecasting.ltsf <span class="im">import</span> LTSFLinearForecaster</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sktime.forecasting.ltsf <span class="im">import</span> LTSFDLinearForecaster</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sktime.forecasting.ltsf <span class="im">import</span> LTSFNLinearForecaster </span></code></pre></div>
</div>
<div id="f4639713" class="cell code" data-execution_count="16">
<div class="sourceCode" id="cb69"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_linear_models(df, df_train, df_test):</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>    fhorizon <span class="op">=</span> ForecastingHorizon(df_test.index, is_relative<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>    seq_len <span class="op">=</span> <span class="bu">len</span>(df_train) <span class="op">-</span> <span class="bu">len</span>(df_test)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>    pred_len <span class="op">=</span> <span class="bu">len</span>(df_test)</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;LTSFLinearForecaster: &quot;</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> LTSFLinearForecaster(seq_len , pred_len)</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>    model.fit(df_train, fh<span class="op">=</span>fhorizon)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model.predict()</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;score: &quot;</span>, model.score(df_test, y_pred))</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>    plot_multi_series(df, y_pred, df.columns)</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;LTSFDLinearForecaster: &quot;</span>)</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> LTSFDLinearForecaster(seq_len , pred_len)</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>    model.fit(df_train, fh<span class="op">=</span>fhorizon)</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model.predict()</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;score: &quot;</span>, model.score(df_test, y_pred))</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>    plot_multi_series(df, y_pred, df.columns)</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;LTSFNLinearForecaster: &quot;</span>)</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> LTSFNLinearForecaster(seq_len , pred_len)</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>    model.fit(df_train, fh<span class="op">=</span>fhorizon)</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model.predict()</span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;score: &quot;</span>, model.score(df_test, y_pred))</span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>    plot_multi_series(df, y_pred, df.columns)</span></code></pre></div>
</div>
<div id="360edf63" class="cell code" data-execution_count="17">
<div class="sourceCode" id="cb70"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>train_linear_models(df_energy, df_energy_train, df_energy_test)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>LTSFLinearForecaster: 
score:  0.6431191094522157
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/cc959f9114bfc44720b900399ea31abff088579d.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/e5353e5c9f07ef74d7aa257dbee5d7042ea45dbd.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/a88c8c93ef0981b0a49c3cd849c072106eddf969.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/ccf7090c5bb36d4a4aceaca3bb6341cd9ca7e0e0.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/7f56c35aa454d154203f38f9227fe139ebe98862.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/a9f9fa4449ea66d6d16b821cd339f6c64b422cb5.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>LTSFDLinearForecaster: 
score:  0.6348828831752518
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/e6340e9e502d2fcb3bd43b7f203433ea30b7fa6f.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/61bc17c4605cf64e2c20fca8a8d92231951517b3.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/c0ac41a281a9fd554f2657e7c67f200ebcfa209c.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/62dc77c9c85604dbff9d296c7148462a1de6ccf8.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/995795b522dca3706cdbce8c8b9434d1b1848f74.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/8b1b8c85daee6015db747a37dadfabe1d494c5c9.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>LTSFNLinearForecaster: 
score:  0.7744009753002681
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/4d7e197058e4eceeed9b1e832f7c8c771a781e4f.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/f3647502482e5c7973bc1c61e56d231065f31364.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/81c2f0a277ce4684afdcf20a30ef89954d7cfbd4.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/f09f7e8f6ffce8113e479eb41d82ff3d95276803.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/0ac393fb93f614e705be39150ee628e5d5ce949e.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/d2b1822c35b77ff7e766b10983563b1657bcc55f.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<div id="2a95fd16" class="cell code" data-execution_count="18">
<div class="sourceCode" id="cb92"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>train_linear_models(df_pasta, df_pasta_train, df_pasta_test)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>LTSFLinearForecaster: 
score:  1.5516226944516822
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/36e9b52efb4601ada70c1d3de1f8122c5af244a7.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/be173c192b53997ac4f38549d295f6e31c9de998.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/0fef9f400099d84ecf99cfd07ece5218fa459f5a.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/f9159bedd9fb36f5d452d9220615a711a495dc24.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>LTSFDLinearForecaster: 
score:  1.5381417220521025
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/e044d161a7cd4817a57fd93c6b65df7c55d86b44.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/8337209b4ded4b723f1a30fe8c0c0f8d5f4a829b.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/823b16f687217bd1cdb1beade04e3f8130454e4e.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/c78241e9d331e766602b55b4484df2e8c7a8e074.png" /></p>
</div>
<div class="output stream stdout">
<pre><code>LTSFNLinearForecaster: 
score:  1.4880366077197107
</code></pre>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/d60bb6d8e08b751578e84bc6e7633a266d17ed97.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/1ffbfd1cc360cd2e26cf1a72c476b267d4084be9.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/f2495999cba5d4749cf3d03e08dd35ea3ec826b1.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/4ee9f774b99219ba73f3b865e74d9bf49624a871.png" /></p>
</div>
<div class="output display_data">
<pre><code>&lt;Figure size 640x480 with 0 Axes&gt;</code></pre>
</div>
</div>
<div id="fe2568b8-117e-456b-bfa7-8050c4506378" class="cell markdown">
<h3 id="mlp-based-models-2-points">MLP-based models (2 points)</h3>
</div>
<div id="af3c39c6-e072-418f-ae1a-85db30f3c871" class="cell markdown">
<p>Implement MLP-based neural models:</p>
<ul>
<li>N-BEATS</li>
<li>TSMixer</li>
</ul>
<p>For N-BEATS, use the interpretable architecture variant. If you want
to tune hyperparameters, you can use e.g. automated class from
<code>neuralforecast</code> with Ray or Optuna frameworks.</p>
<p>Training each model on each dataset is worth 0.5 points. Useful
libraries: <code>neuralforecast</code>, PyTorch,
<code>pytorch-tsmixer</code>.</p>
<p>Other interesting MLP-based models are e.g. N-HiTS, TiDE, TimeMixer,
SOFTS. Each additional model is graded like models above.</p>
<p>Useful references:</p>
<ul>
<li><a href="https://arxiv.org/abs/1905.10437">"N-BEATS: Neural basis
expansion analysis for interpretable time series forecasting" B.
Oreshkin et al.</a></li>
<li><a href="https://arxiv.org/abs/2303.06053">"TSMixer: An All-MLP
Architecture for Time Series Forecasting" S. Chen et al.</a></li>
<li><a href="https://arxiv.org/abs/2201.12886">"N-HiTS: Neural
Hierarchical Interpolation for Time Series Forecasting" C. Challu et
al.</a></li>
<li><a href="https://arxiv.org/abs/2304.08424">"Long-term Forecasting
with TiDE: Time-series Dense Encoder" A. Das et al.</a></li>
<li><a href="https://arxiv.org/abs/2405.14616">"TimeMixer: Decomposable
Multiscale Mixing for Time Series Forecasting" S. Wang et al.</a></li>
<li><a href="https://arxiv.org/abs/2404.14197">"SOFTS: Efficient
Multivariate Time Series Forecasting with Series-Core Fusion" L. Han et
al.</a></li>
<li><a
href="https://nixtlaverse.nixtla.io/neuralforecast/docs/capabilities/overview.html">neuralforecast
forecasting models list</a></li>
</ul>
</div>
<div id="68811c0f" class="cell code" data-execution_count="19">
<div class="sourceCode" id="cb108"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> neuralforecast <span class="im">import</span> NeuralForecast</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> neuralforecast.models <span class="im">import</span> NBEATS</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> neuralforecast.losses.pytorch <span class="im">import</span> DistributionLoss</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> neuralforecast.losses.pytorch <span class="im">import</span> MAE</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score, mean_absolute_error</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sktime.performance_metrics.forecasting <span class="im">import</span> mean_absolute_scaled_error</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> neuralforecast.models <span class="im">import</span> TSMixer</span></code></pre></div>
</div>
<div id="8b2bfec8" class="cell code" data-execution_count="20">
<div class="sourceCode" id="cb109"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data preparation</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>y_train_energy_mlp_based <span class="op">=</span> df_energy_train.copy()</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>y_test_energy_mlp_based <span class="op">=</span> df_energy_test.copy()</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>energy_source_labels <span class="op">=</span> df_energy.columns</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>y_train_energy_mlp_based <span class="op">=</span> wide_to_long_df(y_train_energy_mlp_based)</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>y_test_energy_mlp_based <span class="op">=</span> wide_to_long_df(y_test_energy_mlp_based)</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>y_train_pasta_mlp_based <span class="op">=</span> df_pasta_train.copy()</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>y_test_pasta_mlp_based <span class="op">=</span> df_pasta_test.copy()</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a>pasta_labels <span class="op">=</span> df_pasta.columns</span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>y_train_pasta_mlp_based <span class="op">=</span> wide_to_long_df(y_train_pasta_mlp_based)</span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>y_test_pasta_mlp_based <span class="op">=</span> wide_to_long_df(y_test_pasta_mlp_based)</span></code></pre></div>
</div>
<div id="d576ee1f" class="cell code" data-execution_count="21">
<div class="sourceCode" id="cb110"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_scores_MLP_based(forecast, y_test, y_train, distinctive_label<span class="op">=</span><span class="st">&quot;NBEATS&quot;</span>):</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(forecasts_tsmixer)</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> forecast.loc[:, [<span class="st">&quot;ds&quot;</span>, distinctive_label]]</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> y_pred.set_index(<span class="st">&quot;ds&quot;</span>)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(y_pred)</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>    y_true <span class="op">=</span> y_test.loc[:, [<span class="st">&quot;ds&quot;</span>, <span class="st">&quot;y&quot;</span>]]</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>    y_true <span class="op">=</span> y_true.set_index(<span class="st">&quot;ds&quot;</span>)</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(y_true)</span></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y_train.loc[:, [<span class="st">&quot;ds&quot;</span>, <span class="st">&quot;y&quot;</span>]]</span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>    y_train <span class="op">=</span> y_train.set_index(<span class="st">&quot;ds&quot;</span>)</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(y_train)</span></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;R^2 score: &quot;</span>, r2_score(y_true, y_pred))</span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;MAE score: &quot;</span>, mean_absolute_error(y_true, y_pred))</span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;MASE score: &quot;</span>, mean_absolute_scaled_error(y_true, y_pred, y_train<span class="op">=</span>y_train))</span></code></pre></div>
</div>
<div id="5ec6f2d9" class="cell code" data-execution_count="22">
<div class="sourceCode" id="cb111"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_multi_series_MLP_based(forecasts, labels, y_test, y_train, distinctive_label<span class="op">=</span><span class="st">&quot;NBEATS&quot;</span>):</span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>    Y_hat_df <span class="op">=</span> forecasts.reset_index(drop<span class="op">=</span><span class="va">False</span>).drop(columns<span class="op">=</span>[<span class="st">&#39;unique_id&#39;</span>,<span class="st">&#39;ds&#39;</span>])</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="op">=</span> pd.concat([y_test, Y_hat_df], axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="op">=</span> pd.concat([y_train, plot_df])</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> label <span class="kw">in</span> labels:</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>        plot_df_label <span class="op">=</span> plot_df[plot_df.unique_id<span class="op">==</span>label].drop(<span class="st">&#39;unique_id&#39;</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>        plt.plot(plot_df_label[<span class="st">&#39;ds&#39;</span>], plot_df_label[<span class="st">&#39;y&#39;</span>], label<span class="op">=</span><span class="st">&#39;True&#39;</span>)</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>        plt.plot(plot_df_label[<span class="st">&#39;ds&#39;</span>], plot_df_label[distinctive_label], label<span class="op">=</span><span class="st">&#39;median&#39;</span>)</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>        plt.grid()</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a>        plt.title(label)</span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a>        plt.plot()</span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>        plt.show()</span></code></pre></div>
</div>
<div id="12557bfa-b122-4ff3-8d86-90d7544bcbab" class="cell code"
data-execution_count="23">
<div class="sourceCode" id="cb112"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_model_for_energy_NBEATS(y_train_mlp_based, y_test_mlp_based, energy_source_labels):</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Training NBEATS model for energy&quot;</span>)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>    model_nbeats <span class="op">=</span> NBEATS(h<span class="op">=</span><span class="dv">308</span>, input_size<span class="op">=</span><span class="dv">31</span>,</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>                loss<span class="op">=</span>MAE(),</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>                stack_types <span class="op">=</span> [<span class="st">&#39;identity&#39;</span>, <span class="st">&#39;trend&#39;</span>, <span class="st">&#39;seasonality&#39;</span>],</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>                max_steps<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a>                val_check_steps<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a>                early_stop_patience_steps<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a>                learning_rate<span class="op">=</span><span class="fl">5e-5</span>)</span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>    fcst_nbeats <span class="op">=</span> NeuralForecast(</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>        models<span class="op">=</span>[model_nbeats],</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>        freq<span class="op">=</span><span class="st">&#39;D&#39;</span></span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a>    fcst_nbeats.fit(df<span class="op">=</span>y_train_mlp_based, val_size<span class="op">=</span><span class="dv">308</span>)</span>
<span id="cb112-18"><a href="#cb112-18" aria-hidden="true" tabindex="-1"></a>    forecasted_nbeats <span class="op">=</span> fcst_nbeats.predict(futr_df<span class="op">=</span>y_test_mlp_based)</span>
<span id="cb112-19"><a href="#cb112-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(forecasted_nbeats)</span></span>
<span id="cb112-20"><a href="#cb112-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-21"><a href="#cb112-21" aria-hidden="true" tabindex="-1"></a>    calculate_scores_MLP_based(forecasted_nbeats, y_test_mlp_based, y_train_mlp_based)</span>
<span id="cb112-22"><a href="#cb112-22" aria-hidden="true" tabindex="-1"></a>    plot_multi_series_MLP_based(forecasted_nbeats, energy_source_labels, y_test_mlp_based, y_train_mlp_based)</span>
<span id="cb112-23"><a href="#cb112-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-24"><a href="#cb112-24" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_model_for_energy_TSMixer(y_train_mlp_based, y_test_mlp_based, energy_source_labels):</span>
<span id="cb112-25"><a href="#cb112-25" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Training TSMixer model for energy&quot;</span>)</span>
<span id="cb112-26"><a href="#cb112-26" aria-hidden="true" tabindex="-1"></a>    model_tsmixer <span class="op">=</span> TSMixer(h<span class="op">=</span><span class="dv">308</span>,</span>
<span id="cb112-27"><a href="#cb112-27" aria-hidden="true" tabindex="-1"></a>                input_size<span class="op">=</span><span class="dv">31</span>,</span>
<span id="cb112-28"><a href="#cb112-28" aria-hidden="true" tabindex="-1"></a>                n_series<span class="op">=</span><span class="dv">6</span>, </span>
<span id="cb112-29"><a href="#cb112-29" aria-hidden="true" tabindex="-1"></a>                n_block<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb112-30"><a href="#cb112-30" aria-hidden="true" tabindex="-1"></a>                ff_dim<span class="op">=</span><span class="dv">6</span>,</span>
<span id="cb112-31"><a href="#cb112-31" aria-hidden="true" tabindex="-1"></a>                dropout<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb112-32"><a href="#cb112-32" aria-hidden="true" tabindex="-1"></a>                revin<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb112-33"><a href="#cb112-33" aria-hidden="true" tabindex="-1"></a>                scaler_type<span class="op">=</span><span class="st">&#39;standard&#39;</span>,</span>
<span id="cb112-34"><a href="#cb112-34" aria-hidden="true" tabindex="-1"></a>                max_steps<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb112-35"><a href="#cb112-35" aria-hidden="true" tabindex="-1"></a>                early_stop_patience_steps<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb112-36"><a href="#cb112-36" aria-hidden="true" tabindex="-1"></a>                val_check_steps<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb112-37"><a href="#cb112-37" aria-hidden="true" tabindex="-1"></a>                learning_rate<span class="op">=</span><span class="fl">1e-3</span>,</span>
<span id="cb112-38"><a href="#cb112-38" aria-hidden="true" tabindex="-1"></a>                loss<span class="op">=</span>MAE(),</span>
<span id="cb112-39"><a href="#cb112-39" aria-hidden="true" tabindex="-1"></a>                valid_loss<span class="op">=</span>MAE(),</span>
<span id="cb112-40"><a href="#cb112-40" aria-hidden="true" tabindex="-1"></a>                batch_size<span class="op">=</span><span class="dv">32</span></span>
<span id="cb112-41"><a href="#cb112-41" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb112-42"><a href="#cb112-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-43"><a href="#cb112-43" aria-hidden="true" tabindex="-1"></a>    fcst_tsmixer <span class="op">=</span> NeuralForecast(</span>
<span id="cb112-44"><a href="#cb112-44" aria-hidden="true" tabindex="-1"></a>        models<span class="op">=</span>[model_tsmixer], </span>
<span id="cb112-45"><a href="#cb112-45" aria-hidden="true" tabindex="-1"></a>        freq<span class="op">=</span><span class="st">&#39;D&#39;</span></span>
<span id="cb112-46"><a href="#cb112-46" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb112-47"><a href="#cb112-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-48"><a href="#cb112-48" aria-hidden="true" tabindex="-1"></a>    fcst_tsmixer.fit(df<span class="op">=</span>y_train_mlp_based, val_size<span class="op">=</span><span class="dv">308</span>)</span>
<span id="cb112-49"><a href="#cb112-49" aria-hidden="true" tabindex="-1"></a>    forecasted_tsmixer <span class="op">=</span> fcst_tsmixer.predict(futr_df<span class="op">=</span>y_test_mlp_based)</span>
<span id="cb112-50"><a href="#cb112-50" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(forecasted_tsmixer)</span></span>
<span id="cb112-51"><a href="#cb112-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-52"><a href="#cb112-52" aria-hidden="true" tabindex="-1"></a>    calculate_scores_MLP_based(forecasted_tsmixer, y_test_mlp_based, y_train_mlp_based, distinctive_label<span class="op">=</span><span class="st">&quot;TSMixer&quot;</span>)</span>
<span id="cb112-53"><a href="#cb112-53" aria-hidden="true" tabindex="-1"></a>    plot_multi_series_MLP_based(forecasted_tsmixer, energy_source_labels, y_test_mlp_based, y_train_mlp_based, distinctive_label<span class="op">=</span><span class="st">&quot;TSMixer&quot;</span>)</span>
<span id="cb112-54"><a href="#cb112-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-55"><a href="#cb112-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-56"><a href="#cb112-56" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_model_for_energy():</span>
<span id="cb112-57"><a href="#cb112-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-58"><a href="#cb112-58" aria-hidden="true" tabindex="-1"></a>    train_model_for_energy_NBEATS(y_train_energy_mlp_based, y_test_energy_mlp_based, energy_source_labels)</span>
<span id="cb112-59"><a href="#cb112-59" aria-hidden="true" tabindex="-1"></a>    train_model_for_energy_TSMixer(y_train_energy_mlp_based, y_test_energy_mlp_based, energy_source_labels)</span></code></pre></div>
</div>
<div id="36f9de91" class="cell code" data-execution_count="24">
<div class="sourceCode" id="cb113"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_model_for_pasta_NBEATS(y_train_mlp_based, y_test_mlp_based, pasta_types_labels):</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Training NBEATS model for pasta&quot;</span>)</span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>    model_nbeats <span class="op">=</span> NBEATS(h<span class="op">=</span><span class="dv">365</span>, input_size<span class="op">=</span><span class="dv">31</span>,</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>                loss<span class="op">=</span>MAE(),</span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a>                stack_types <span class="op">=</span> [<span class="st">&#39;identity&#39;</span>, <span class="st">&#39;trend&#39;</span>, <span class="st">&#39;seasonality&#39;</span>],</span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>                max_steps<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>                val_check_steps<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>                early_stop_patience_steps<span class="op">=</span><span class="dv">2</span>,</span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>                learning_rate<span class="op">=</span><span class="fl">5e-5</span>)</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a>    fcst_nbeats <span class="op">=</span> NeuralForecast(</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a>        models<span class="op">=</span>[model_nbeats],</span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a>        freq<span class="op">=</span><span class="st">&#39;D&#39;</span></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>    fcst_nbeats.fit(df<span class="op">=</span>y_train_mlp_based, val_size<span class="op">=</span><span class="dv">365</span>)</span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>    forecasted_nbeats <span class="op">=</span> fcst_nbeats.predict(futr_df<span class="op">=</span>y_test_mlp_based)</span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>    calculate_scores_MLP_based(forecasted_nbeats, y_test_mlp_based, y_train_mlp_based)</span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>    plot_multi_series_MLP_based(forecasted_nbeats, pasta_types_labels, y_test_mlp_based, y_train_mlp_based)</span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_model_for_pasta_TSMixer(y_train_mlp_based, y_test_mlp_based, pasta_types_labels):</span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">&quot;Training TSMixer model for pasta&quot;</span>)</span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>    model_tsmixer <span class="op">=</span> TSMixer(h<span class="op">=</span><span class="dv">365</span>,</span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a>                input_size<span class="op">=</span><span class="dv">31</span>,</span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a>                n_series<span class="op">=</span><span class="dv">4</span>, </span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a>                n_block<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a>                ff_dim<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a>                dropout<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a>                revin<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a>                scaler_type<span class="op">=</span><span class="st">&#39;standard&#39;</span>,</span>
<span id="cb113-32"><a href="#cb113-32" aria-hidden="true" tabindex="-1"></a>                max_steps<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb113-33"><a href="#cb113-33" aria-hidden="true" tabindex="-1"></a>                early_stop_patience_steps<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb113-34"><a href="#cb113-34" aria-hidden="true" tabindex="-1"></a>                val_check_steps<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb113-35"><a href="#cb113-35" aria-hidden="true" tabindex="-1"></a>                learning_rate<span class="op">=</span><span class="fl">1e-3</span>,</span>
<span id="cb113-36"><a href="#cb113-36" aria-hidden="true" tabindex="-1"></a>                loss<span class="op">=</span>MAE(),</span>
<span id="cb113-37"><a href="#cb113-37" aria-hidden="true" tabindex="-1"></a>                valid_loss<span class="op">=</span>MAE(),</span>
<span id="cb113-38"><a href="#cb113-38" aria-hidden="true" tabindex="-1"></a>                batch_size<span class="op">=</span><span class="dv">32</span></span>
<span id="cb113-39"><a href="#cb113-39" aria-hidden="true" tabindex="-1"></a>                )</span>
<span id="cb113-40"><a href="#cb113-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-41"><a href="#cb113-41" aria-hidden="true" tabindex="-1"></a>    fcst_tsmixer <span class="op">=</span> NeuralForecast(</span>
<span id="cb113-42"><a href="#cb113-42" aria-hidden="true" tabindex="-1"></a>        models<span class="op">=</span>[model_tsmixer], </span>
<span id="cb113-43"><a href="#cb113-43" aria-hidden="true" tabindex="-1"></a>        freq<span class="op">=</span><span class="st">&#39;D&#39;</span></span>
<span id="cb113-44"><a href="#cb113-44" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb113-45"><a href="#cb113-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-46"><a href="#cb113-46" aria-hidden="true" tabindex="-1"></a>    fcst_tsmixer.fit(df<span class="op">=</span>y_train_mlp_based, val_size<span class="op">=</span><span class="dv">365</span>)</span>
<span id="cb113-47"><a href="#cb113-47" aria-hidden="true" tabindex="-1"></a>    forecasted_tsmixer <span class="op">=</span> fcst_tsmixer.predict(futr_df<span class="op">=</span>y_test_mlp_based)</span>
<span id="cb113-48"><a href="#cb113-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(forecasted_tsmixer)</span></span>
<span id="cb113-49"><a href="#cb113-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-50"><a href="#cb113-50" aria-hidden="true" tabindex="-1"></a>    calculate_scores_MLP_based(forecasted_tsmixer, y_test_mlp_based, y_train_mlp_based, distinctive_label<span class="op">=</span><span class="st">&quot;TSMixer&quot;</span>)</span>
<span id="cb113-51"><a href="#cb113-51" aria-hidden="true" tabindex="-1"></a>    plot_multi_series_MLP_based(forecasted_tsmixer, pasta_types_labels, y_test_mlp_based, y_train_mlp_based, distinctive_label<span class="op">=</span><span class="st">&quot;TSMixer&quot;</span>)</span>
<span id="cb113-52"><a href="#cb113-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-53"><a href="#cb113-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-54"><a href="#cb113-54" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_model_for_pasta():</span>
<span id="cb113-55"><a href="#cb113-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-56"><a href="#cb113-56" aria-hidden="true" tabindex="-1"></a>    train_model_for_pasta_NBEATS(y_train_pasta_mlp_based, y_test_pasta_mlp_based, pasta_labels)</span>
<span id="cb113-57"><a href="#cb113-57" aria-hidden="true" tabindex="-1"></a>    train_model_for_pasta_TSMixer(y_train_pasta_mlp_based, y_test_pasta_mlp_based, pasta_labels)</span></code></pre></div>
</div>
<div id="ffb8a721" class="cell code" data-execution_count="25">
<div class="sourceCode" id="cb114"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>train_model_for_energy()</span></code></pre></div>
<div class="output stream stderr">
<pre><code>Seed set to 1
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs

  | Name         | Type          | Params
-----------------------------------------------
0 | loss         | MAE           | 0     
1 | padder_train | ConstantPad1d | 0     
2 | scaler       | TemporalNorm  | 0     
3 | blocks       | ModuleList    | 3.4 M 
-----------------------------------------------
3.2 M     Trainable params
209 K     Non-trainable params
3.4 M     Total params
13.717    Total estimated model params size (MB)
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Training NBEATS model for energy
</code></pre>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb117"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;184bb8b3a5f04171a5d28771f66ae2c5&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb118"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;a51f5e4ee5d643e2a8c0824c7ccffdd8&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb119"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;8a4d3ad2eff6429497ea2dc892f6558e&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb120"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;125f02a675ac45b882cef21b6dfebf1e&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb121"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;144d84e37e6944f89c0a6d25c582a9f9&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stderr">
<pre><code>Trainer already configured with model summary callbacks: [&lt;class &#39;pytorch_lightning.callbacks.model_summary.ModelSummary&#39;&gt;]. Skipping setting a default `ModelSummary` callback.
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
</code></pre>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb123"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;ec9fd63dd94f4436862c095fc7e52e76&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stdout">
<pre><code>R^2 score:  0.6647300159877814
MAE score:  35.20484503630023
MASE score:  3.7894116792708523
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/42491607673c934288b4216df44c3e87fa0ad800.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/4db6838f4658f521718d2f59d96615b6a71cc9ca.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/726950d56f43b985de03ad0b008b6583277731cd.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/8cf704082410afd741aab94665d4e3e4e8cdce2a.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/bf2d0238325d9c26542fcde87ae3bd13a47db19e.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/196bf57456edc3de1639024565850b9688b49ed6.png" /></p>
</div>
<div class="output stream stderr">
<pre><code>Seed set to 1
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs

  | Name          | Type                     | Params
-----------------------------------------------------------
0 | loss          | MAE                      | 0     
1 | valid_loss    | MAE                      | 0     
2 | padder        | ConstantPad1d            | 0     
3 | scaler        | TemporalNorm             | 0     
4 | norm          | ReversibleInstanceNorm1d | 12    
5 | mixing_layers | Sequential               | 10.9 K
6 | out           | Linear                   | 9.9 K 
-----------------------------------------------------------
20.8 K    Trainable params
0         Non-trainable params
20.8 K    Total params
0.083     Total estimated model params size (MB)
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Training TSMixer model for energy
</code></pre>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb127"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;12f691fedf364fb399cf7eb5b4a65b98&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb128"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;4214e80ea980471dab5cbb6faf5711c5&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb129"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;06d49734286742efa4a8a9db1ceff008&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb130"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;baf730b4001d4416b1c492d692785dfb&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb131"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;3cbde6f07aa8403e9ba37fbcd34e754f&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb132"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;6d4967835e3649aeb3383a4a72e5c354&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb133"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;6a0c9a4ca2eb4e8cbd924e976f82566b&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb134"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;a9f3f60e7a7f476682bd20f854d1ce63&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb135"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;cb3a0bc470074bd58ef5312247a100a5&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb136"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;bfdbed2a7a184a5cb92c02eb536153f0&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb137"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;e043db95c82a4062857eed886cf4562e&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb138"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;f57a1b2ca5b64a4a9f7e42b14374c974&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stderr">
<pre><code>`Trainer.fit` stopped: `max_steps=300` reached.
Trainer already configured with model summary callbacks: [&lt;class &#39;pytorch_lightning.callbacks.model_summary.ModelSummary&#39;&gt;]. Skipping setting a default `ModelSummary` callback.
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
</code></pre>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb140"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;b7a5a731f05b4d438b13e9e6ed867462&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stdout">
<pre><code>R^2 score:  0.7059662700314062
MAE score:  32.4758296474977
MASE score:  3.495663396141781
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/656b253fc6432bfc7a37d8103d97dbf914857a55.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/225ec659c9bc33bcf03c7c59f7586b4c7cd4fc29.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/5546d41121f8fe2cd63e515e432f5284467bdcbd.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/800db1ad7c200b81389301ed2010c10cfe98c0ac.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/e9b20ec0d5b69f74b09ca4eab305337c37b77c07.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/1fc4fbd3d67526df1383cfc24be9d2cae7c01bc4.png" /></p>
</div>
</div>
<div id="56b1a442" class="cell code" data-execution_count="26">
<div class="sourceCode" id="cb142"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>train_model_for_pasta()</span></code></pre></div>
<div class="output stream stderr">
<pre><code>Seed set to 1
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs

  | Name         | Type          | Params
-----------------------------------------------
0 | loss         | MAE           | 0     
1 | padder_train | ConstantPad1d | 0     
2 | scaler       | TemporalNorm  | 0     
3 | blocks       | ModuleList    | 3.7 M 
-----------------------------------------------
3.4 M     Trainable params
289 K     Non-trainable params
3.7 M     Total params
14.623    Total estimated model params size (MB)
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Training NBEATS model for pasta
</code></pre>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb145"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;9fb538aa392d446b95da787db11b34ef&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb146"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;b27b7f6cfd7642129288916812132949&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb147"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;6932749e2e2b4e208e69b7e5ba9b84b4&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb148"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;9c3aa8d9e41c4104a2c91c061b598376&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb149"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;e767bd73c8224e268c77059bdce3da0c&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb150"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;7f28a3b829cb4f069bbfeea1f30de827&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb151"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;f9734ac41c0a44619e1b1a30da604029&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb152"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;1692e84c803446d788e7fd376376ad8b&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb153"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;db3bc2c1798540178e542ed426635c81&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stderr">
<pre><code>Trainer already configured with model summary callbacks: [&lt;class &#39;pytorch_lightning.callbacks.model_summary.ModelSummary&#39;&gt;]. Skipping setting a default `ModelSummary` callback.
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
</code></pre>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb155"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;f8d19913e60342b0930095e70754e735&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stdout">
<pre><code>R^2 score:  0.42575110690718365
MAE score:  39.14086563815809
MASE score:  0.9082991787566226
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/143011aedfbf800a364a8ff6ac853fb314e60b45.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/5d0ff10b27830d18b1f7ab974d6939cd51517618.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/8568f697e0b198329861a4c21de5931ae7c507de.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/6c5672354610280903331f3483fb7ff13b7f7a82.png" /></p>
</div>
<div class="output stream stderr">
<pre><code>Seed set to 1
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs

  | Name          | Type                     | Params
-----------------------------------------------------------
0 | loss          | MAE                      | 0     
1 | valid_loss    | MAE                      | 0     
2 | padder        | ConstantPad1d            | 0     
3 | scaler        | TemporalNorm             | 0     
4 | norm          | ReversibleInstanceNorm1d | 8     
5 | mixing_layers | Sequential               | 6.1 K 
6 | out           | Linear                   | 11.7 K
-----------------------------------------------------------
17.8 K    Trainable params
0         Non-trainable params
17.8 K    Total params
0.071     Total estimated model params size (MB)
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Training TSMixer model for pasta
</code></pre>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb159"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;fa888ab1319a4f33aa452bc51db6270e&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb160"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;82c5e86082da4edea1b10bdbcfa321cb&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb161"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;078961d204fe4aa7b752f923a640eaf8&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb162"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;7b8f5a26a26a4e5f93196d9e6fc4e715&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb163"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;b9b0de6042f5449da6d9730c4468e133&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb164"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;9bd820fa47684dcab15da030b94b71d4&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb165"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;3b690acb4ad248f0a039ed65d62040cf&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb166"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;5df00f46f6a043528c18082977e7178d&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb167"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;537d34d717f345bfb3d247647d067f18&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb168"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;a695347d38b84a5082b996e7ff371aea&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb169"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;bf1fb994ccf54e1389a6a554db2b2d10&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb170"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;fcb7ac43d8bd4a75b63fb82878d4101b&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stderr">
<pre><code>`Trainer.fit` stopped: `max_steps=300` reached.
Trainer already configured with model summary callbacks: [&lt;class &#39;pytorch_lightning.callbacks.model_summary.ModelSummary&#39;&gt;]. Skipping setting a default `ModelSummary` callback.
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
</code></pre>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb172"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;078948377bad4b0e843c23f976cfceab&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stdout">
<pre><code>R^2 score:  0.43034374531251207
MAE score:  36.83787752830819
MASE score:  0.854856257279085
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/2b949e83ceb98351fc42296d1d16956beaed17c9.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/cd81adaf00dc4aabb0edac88dc9c7dbe662b3f73.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/3ba7dac1d68592cd07d27aa03f03aba9901142ae.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/2bc312783fa416de7f09e38be06b6bb10f125c22.png" /></p>
</div>
</div>
<div id="2847724c-9658-42c6-b7bb-f264f429231f" class="cell markdown">
<h3 id="time-series-transformers-2-points">Time series transformers (2
points)</h3>
</div>
<div id="c301a2c2-728c-45b2-bebb-0ab76ac6a6ee" class="cell markdown">
<p>Implement a time series transformer, e.g. PatchTST.</p>
<p>You can use either pretrained variant, or train from scratch. If you
want to tune hyperparameters, you can use e.g. automated class from
<code>neuralforecast</code> with Ray or Optuna frameworks.</p>
<p>Training the model in any way is worth 2 points. You can also choose
any other time series transformer, e.g. TFT, iTransformer, Autoformer.
Useful libraries: <code>neuralforecast</code>, PyTorch,
<code>transformers</code>, IBM Granite. Each model after the first one
is worth 1 point. If you use PatchTST, using the pretrained one and
training from scratch counts as two separate models.</p>
<p>Useful references:</p>
<ul>
<li><a href="https://arxiv.org/abs/2211.14730">"A Time Series is Worth
64 Words: Long-term Forecasting with Transformers" Y. Nie et
al.</a></li>
<li><a href="https://arxiv.org/abs/1912.09363">"Temporal Fusion
Transformers for Interpretable Multi-horizon Time Series Forecasting" B.
Lim et al.</a></li>
<li><a href="https://arxiv.org/abs/2310.06625">"iTransformer: Inverted
Transformers Are Effective for Time Series Forecasting" Y. Liu et
al.</a></li>
<li><a href="https://arxiv.org/abs/2106.13008">"Autoformer:
Decomposition Transformers with Auto-Correlation for Long-Term Series
Forecasting" H. Wu et al.</a></li>
<li><a
href="https://nixtlaverse.nixtla.io/neuralforecast/docs/capabilities/overview.html">neuralforecast
forecasting models list</a></li>
<li><a
href="https://github.com/ibm-granite/granite-tsfm/blob/main/notebooks/hfdemo/patch_tst_getting_started.ipynb">IBM
Granite tutorial for pretrained PatchTST</a></li>
</ul>
</div>
<div id="14e8dc59-56f8-4201-9256-471a97fafa99" class="cell code"
data-execution_count="27">
<div class="sourceCode" id="cb174"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> neuralforecast.models <span class="im">import</span> PatchTST</span></code></pre></div>
</div>
<div id="4d99d757" class="cell code" data-execution_count="28">
<div class="sourceCode" id="cb175"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_model_for_energy_patchTST(y_train_mlp_based, y_test_mlp_based, energy_source_labels):</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a>    y_train_mlp_based <span class="op">=</span> df_energy_train.copy()</span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a>    y_test_mlp_based <span class="op">=</span> df_energy_test.copy()</span>
<span id="cb175-4"><a href="#cb175-4" aria-hidden="true" tabindex="-1"></a>    energy_source_labels <span class="op">=</span> df_energy.columns</span>
<span id="cb175-5"><a href="#cb175-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-6"><a href="#cb175-6" aria-hidden="true" tabindex="-1"></a>    y_train_mlp_based <span class="op">=</span> wide_to_long_df(y_train_mlp_based)</span>
<span id="cb175-7"><a href="#cb175-7" aria-hidden="true" tabindex="-1"></a>    y_test_mlp_based <span class="op">=</span> wide_to_long_df(y_test_mlp_based)</span>
<span id="cb175-8"><a href="#cb175-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-9"><a href="#cb175-9" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> PatchTST(h<span class="op">=</span><span class="dv">308</span>,</span>
<span id="cb175-10"><a href="#cb175-10" aria-hidden="true" tabindex="-1"></a>                 input_size<span class="op">=</span><span class="dv">31</span>,</span>
<span id="cb175-11"><a href="#cb175-11" aria-hidden="true" tabindex="-1"></a>                 patch_len<span class="op">=</span><span class="dv">365</span>,</span>
<span id="cb175-12"><a href="#cb175-12" aria-hidden="true" tabindex="-1"></a>                 stride<span class="op">=</span><span class="dv">31</span>,</span>
<span id="cb175-13"><a href="#cb175-13" aria-hidden="true" tabindex="-1"></a>                 dropout<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb175-14"><a href="#cb175-14" aria-hidden="true" tabindex="-1"></a>                 revin<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb175-15"><a href="#cb175-15" aria-hidden="true" tabindex="-1"></a>                 hidden_size<span class="op">=</span><span class="dv">16</span>,</span>
<span id="cb175-16"><a href="#cb175-16" aria-hidden="true" tabindex="-1"></a>                 n_heads<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb175-17"><a href="#cb175-17" aria-hidden="true" tabindex="-1"></a>                 scaler_type<span class="op">=</span><span class="st">&#39;robust&#39;</span>,</span>
<span id="cb175-18"><a href="#cb175-18" aria-hidden="true" tabindex="-1"></a>                 loss<span class="op">=</span>MAE(),</span>
<span id="cb175-19"><a href="#cb175-19" aria-hidden="true" tabindex="-1"></a>                 learning_rate<span class="op">=</span><span class="fl">5e-5</span>,</span>
<span id="cb175-20"><a href="#cb175-20" aria-hidden="true" tabindex="-1"></a>                 max_steps<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb175-21"><a href="#cb175-21" aria-hidden="true" tabindex="-1"></a>                 val_check_steps<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb175-22"><a href="#cb175-22" aria-hidden="true" tabindex="-1"></a>                 early_stop_patience_steps<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb175-23"><a href="#cb175-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-24"><a href="#cb175-24" aria-hidden="true" tabindex="-1"></a>    fcst_ptst <span class="op">=</span> NeuralForecast(</span>
<span id="cb175-25"><a href="#cb175-25" aria-hidden="true" tabindex="-1"></a>        models<span class="op">=</span>[model],</span>
<span id="cb175-26"><a href="#cb175-26" aria-hidden="true" tabindex="-1"></a>        freq<span class="op">=</span><span class="st">&#39;D&#39;</span></span>
<span id="cb175-27"><a href="#cb175-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb175-28"><a href="#cb175-28" aria-hidden="true" tabindex="-1"></a>    fcst_ptst.fit(df<span class="op">=</span>y_train_mlp_based, val_size<span class="op">=</span><span class="dv">308</span>)</span>
<span id="cb175-29"><a href="#cb175-29" aria-hidden="true" tabindex="-1"></a>    forecasted_pTST <span class="op">=</span> fcst_ptst.predict(futr_df<span class="op">=</span>y_test_mlp_based)</span>
<span id="cb175-30"><a href="#cb175-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-31"><a href="#cb175-31" aria-hidden="true" tabindex="-1"></a>    calculate_scores_MLP_based(forecasted_pTST, y_test_mlp_based, y_train_mlp_based, distinctive_label<span class="op">=</span><span class="st">&quot;PatchTST&quot;</span>)</span>
<span id="cb175-32"><a href="#cb175-32" aria-hidden="true" tabindex="-1"></a>    plot_multi_series_MLP_based(forecasted_pTST, energy_source_labels, y_test_mlp_based, y_train_mlp_based, distinctive_label<span class="op">=</span><span class="st">&quot;PatchTST&quot;</span>)</span></code></pre></div>
</div>
<div id="b5d05b47" class="cell code" data-execution_count="29">
<div class="sourceCode" id="cb176"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> train_model_for_pasta_patchTST(y_train_mlp_based, y_test_mlp_based, pasta_labels):</span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>    y_train_mlp_based <span class="op">=</span> df_pasta_train.copy()</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>    y_test_mlp_based <span class="op">=</span> df_pasta_test.copy()</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>    pasta_labels <span class="op">=</span> df_pasta.columns</span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>    y_train_mlp_based <span class="op">=</span> wide_to_long_df(y_train_mlp_based)</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>    y_test_mlp_based <span class="op">=</span> wide_to_long_df(y_test_mlp_based)</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> PatchTST(h<span class="op">=</span><span class="dv">365</span>,</span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a>                 input_size<span class="op">=</span><span class="dv">31</span>,</span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>                 patch_len<span class="op">=</span><span class="dv">365</span>,</span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a>                 stride<span class="op">=</span><span class="dv">31</span>,</span>
<span id="cb176-13"><a href="#cb176-13" aria-hidden="true" tabindex="-1"></a>                 dropout<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb176-14"><a href="#cb176-14" aria-hidden="true" tabindex="-1"></a>                 revin<span class="op">=</span><span class="va">False</span>,</span>
<span id="cb176-15"><a href="#cb176-15" aria-hidden="true" tabindex="-1"></a>                 hidden_size<span class="op">=</span><span class="dv">16</span>,</span>
<span id="cb176-16"><a href="#cb176-16" aria-hidden="true" tabindex="-1"></a>                 n_heads<span class="op">=</span><span class="dv">4</span>,</span>
<span id="cb176-17"><a href="#cb176-17" aria-hidden="true" tabindex="-1"></a>                 scaler_type<span class="op">=</span><span class="st">&#39;robust&#39;</span>,</span>
<span id="cb176-18"><a href="#cb176-18" aria-hidden="true" tabindex="-1"></a>                 loss<span class="op">=</span>MAE(),</span>
<span id="cb176-19"><a href="#cb176-19" aria-hidden="true" tabindex="-1"></a>                 learning_rate<span class="op">=</span><span class="fl">5e-5</span>,</span>
<span id="cb176-20"><a href="#cb176-20" aria-hidden="true" tabindex="-1"></a>                 max_steps<span class="op">=</span><span class="dv">300</span>,</span>
<span id="cb176-21"><a href="#cb176-21" aria-hidden="true" tabindex="-1"></a>                 val_check_steps<span class="op">=</span><span class="dv">30</span>,</span>
<span id="cb176-22"><a href="#cb176-22" aria-hidden="true" tabindex="-1"></a>                 early_stop_patience_steps<span class="op">=</span><span class="dv">3</span>)</span>
<span id="cb176-23"><a href="#cb176-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-24"><a href="#cb176-24" aria-hidden="true" tabindex="-1"></a>    fcst_ptst <span class="op">=</span> NeuralForecast(</span>
<span id="cb176-25"><a href="#cb176-25" aria-hidden="true" tabindex="-1"></a>        models<span class="op">=</span>[model],</span>
<span id="cb176-26"><a href="#cb176-26" aria-hidden="true" tabindex="-1"></a>        freq<span class="op">=</span><span class="st">&#39;D&#39;</span></span>
<span id="cb176-27"><a href="#cb176-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb176-28"><a href="#cb176-28" aria-hidden="true" tabindex="-1"></a>    fcst_ptst.fit(df<span class="op">=</span>y_train_mlp_based, val_size<span class="op">=</span><span class="dv">365</span>)</span>
<span id="cb176-29"><a href="#cb176-29" aria-hidden="true" tabindex="-1"></a>    forecasted_pTST <span class="op">=</span> fcst_ptst.predict(futr_df<span class="op">=</span>y_test_mlp_based)</span>
<span id="cb176-30"><a href="#cb176-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-31"><a href="#cb176-31" aria-hidden="true" tabindex="-1"></a>    calculate_scores_MLP_based(forecasted_pTST, y_test_mlp_based, y_train_mlp_based, distinctive_label<span class="op">=</span><span class="st">&quot;PatchTST&quot;</span>)</span>
<span id="cb176-32"><a href="#cb176-32" aria-hidden="true" tabindex="-1"></a>    plot_multi_series_MLP_based(forecasted_pTST, pasta_labels, y_test_mlp_based, y_train_mlp_based, distinctive_label<span class="op">=</span><span class="st">&quot;PatchTST&quot;</span>)</span></code></pre></div>
</div>
<div id="90652e41" class="cell code" data-execution_count="30">
<div class="sourceCode" id="cb177"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a>train_model_for_energy_patchTST(y_train_energy_mlp_based, y_test_energy_mlp_based, energy_source_labels)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>Seed set to 1
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs

  | Name         | Type              | Params
---------------------------------------------------
0 | loss         | MAE               | 0     
1 | padder_train | ConstantPad1d     | 0     
2 | scaler       | TemporalNorm      | 0     
3 | model        | PatchTST_backbone | 35.1 K
---------------------------------------------------
35.1 K    Trainable params
3         Non-trainable params
35.1 K    Total params
0.140     Total estimated model params size (MB)
</code></pre>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb180"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;e83a4f5982934c439b9482468d082c50&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb181"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;912c926f25ae403e84bd5b9ebb979f69&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb182"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;161ff77b520f454e83cb1ddd72487771&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb183"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;3bdd99cdb4d04d7cb5f1e6aec272ff5f&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb184"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;b31819e88f9749088f3aeff003f71ef4&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb185"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;57f214bf58cb49eab8e99c2091b5c042&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb186"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;84cf432b83fd45a692911dca4f6d429c&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb187"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;bdce78a4ead34bceab1559453e4be017&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb188"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;74e31ad8b73843ab86c4213f55f0b51d&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb189"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;e647ef6a2c6e447d9d1fb51ebb05c6ee&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb190"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;cef2c8bc214d47e390661b71ce45a6bf&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb191"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;b62bc09c11284e46817306c5098e861d&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stderr">
<pre><code>`Trainer.fit` stopped: `max_steps=300` reached.
Trainer already configured with model summary callbacks: [&lt;class &#39;pytorch_lightning.callbacks.model_summary.ModelSummary&#39;&gt;]. Skipping setting a default `ModelSummary` callback.
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
</code></pre>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb193"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;25e7f0a0ebc4452dba998672ac8adf70&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stdout">
<pre><code>R^2 score:  0.5574304083819828
MAE score:  41.04227206602447
MASE score:  4.417746050307558
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/900d8de524a4388fe6604069902efd9a8f146bb4.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/b094ddb4a0966fe05e5cdd6c2377863fa7c14b5c.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/1d1397c487d972fafd5f5a41d23f3fc22cb1c09d.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/9e97f902e75bda838a2c5887e0d19cf83c6e5e52.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/ea4345c8f255c365e25bea81ca6dffb719b34b39.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/f0ea11ae4513ff19b590395c295cc0e46ffba4e4.png" /></p>
</div>
</div>
<div id="7d515d9a" class="cell code" data-execution_count="31">
<div class="sourceCode" id="cb195"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>train_model_for_pasta_patchTST(y_train_pasta_mlp_based, y_test_pasta_mlp_based, pasta_labels)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>Seed set to 1
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs

  | Name         | Type              | Params
---------------------------------------------------
0 | loss         | MAE               | 0     
1 | padder_train | ConstantPad1d     | 0     
2 | scaler       | TemporalNorm      | 0     
3 | model        | PatchTST_backbone | 36.1 K
---------------------------------------------------
36.1 K    Trainable params
3         Non-trainable params
36.1 K    Total params
0.144     Total estimated model params size (MB)
</code></pre>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb197"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;96fb4b9caaa34ecfb5cd6166de27e9f7&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb198"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;daaf2ae6f21b4063a10f09a3ca98c477&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb199"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;319a45ee8d0a4ea9ad3b4380f8c733f0&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb200"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;d250a00c6bde44f3b785f02170557eaa&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb201"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;b7acbecd8c1e431ba2ad337c56590454&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb202"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;9ffa66aabdd149e780d0336d3de8dc04&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb203"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;2650c06a9482450dbc119e93320b6649&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb204"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;d1480d5b497148b3ae8aee32fb82c3e3&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb205"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;f80a230023e64584898bc6a86d16c51b&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb206"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;74e67764de2b4748886a163ba72762a6&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb207"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;eeb9428578ae47b58c6e4728687049ed&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb208"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;b43d7e6b33f545f5b74f77f0031fa329&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stderr">
<pre><code>`Trainer.fit` stopped: `max_steps=300` reached.
Trainer already configured with model summary callbacks: [&lt;class &#39;pytorch_lightning.callbacks.model_summary.ModelSummary&#39;&gt;]. Skipping setting a default `ModelSummary` callback.
GPU available: False, used: False
TPU available: False, using: 0 TPU cores
IPU available: False, using: 0 IPUs
HPU available: False, using: 0 HPUs
</code></pre>
</div>
<div class="output display_data">
<div class="sourceCode" id="cb210"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;409d987a59e542d3a501a20ba58c92f2&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stdout">
<pre><code>R^2 score:  0.3927433280382632
MAE score:  41.30809288939385
MASE score:  0.9585916467534812
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/10f897b34c01070d4b5716f6cce6f2521b0abed4.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/a9940fbb2d23a6b9b37930e56fe885d514fdcc23.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/59fb76a5ed515689e9d3778ff6749d79f87101f0.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/45fec59147fc95385a1497f286d7c5f92a88d3e3.png" /></p>
</div>
</div>
<div id="a0293c5c-2e33-426f-a814-695c811db10f" class="cell markdown">
<h3 id="pretrained-foundation-models-2-points">Pretrained foundation
models (2 points)</h3>
</div>
<div id="d81206ff-0be4-48ba-a9fa-4a3f74b9d048" class="cell markdown">
<p>Use a pretrained time series foundation model for zero-shot
forecasting.</p>
<p>Examples are e.g. TimesFM, Lag-Llama, TimeGPT, Moirai. Model
notes:</p>
<ol>
<li>TimesFM - using the PyTorch version of original library is
suggested</li>
<li>Lag-Llama - this is a probabilistic model, note that we are
interested in point forecasts (mean probabilistic value)</li>
<li>TimeGPT - as this is a proprietary model, you need to provide the
API token, make sure you don't push it to a public repository!</li>
</ol>
<p>The first model is worth 2 points, and subsequent ones are worth 1
point each.</p>
<p>Useful references:</p>
<ul>
<li><a href="https://arxiv.org/abs/2310.10688">"A decoder-only
foundation model for time-series forecasting" A. Das et al.</a></li>
<li><a href="https://github.com/google-research/timesfm">TimesFM
repository</a></li>
<li><a href="https://arxiv.org/abs/2310.08278">"Lag-Llama: Towards
Foundation Models for Probabilistic Time Series Forecasting" K. Rasul et
al.</a></li>
<li><a
href="https://github.com/time-series-foundation-models/lag-llama">Lag-Llama
repository</a></li>
<li><a href="https://arxiv.org/abs/2310.03589">"TimeGPT-1" A. Garza et
al.</a></li>
<li><a href="https://docs.nixtla.io/">TimeGPT docs</a></li>
<li><a href="https://arxiv.org/abs/2402.02592">"Unified Training of
Universal Time Series Forecasting Transformers" G. Woo et al.</a></li>
<li><a
href="https://huggingface.co/Salesforce/moirai-1.0-R-large">HuggingFace
Moirai model page</a></li>
</ul>
</div>
<div id="ef03538c" class="cell code" data-execution_count="32">
<div class="sourceCode" id="cb212"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> timesfm</span></code></pre></div>
<div class="output stream stdout">
<pre><code>TimesFM v1.2.0. See https://github.com/google-research/timesfm/blob/master/README.md for updated APIs.
Loaded Jax TimesFM.
Loaded PyTorch TimesFM.
</code></pre>
</div>
</div>
<div id="d8bcfd87-c749-46a5-931e-1ab8977b6fe4" class="cell code"
data-execution_count="33">
<div class="sourceCode" id="cb214"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> use_timesfm_pretrained_for_energy(y_train, y_test, labels):</span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>    tfm <span class="op">=</span> timesfm.TimesFm(</span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a>        hparams<span class="op">=</span>timesfm.TimesFmHparams(</span>
<span id="cb214-4"><a href="#cb214-4" aria-hidden="true" tabindex="-1"></a>            backend<span class="op">=</span><span class="st">&quot;cpu&quot;</span>,</span>
<span id="cb214-5"><a href="#cb214-5" aria-hidden="true" tabindex="-1"></a>            per_core_batch_size<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb214-6"><a href="#cb214-6" aria-hidden="true" tabindex="-1"></a>            horizon_len<span class="op">=</span><span class="dv">308</span>,</span>
<span id="cb214-7"><a href="#cb214-7" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb214-8"><a href="#cb214-8" aria-hidden="true" tabindex="-1"></a>        checkpoint<span class="op">=</span>timesfm.TimesFmCheckpoint(</span>
<span id="cb214-9"><a href="#cb214-9" aria-hidden="true" tabindex="-1"></a>            huggingface_repo_id<span class="op">=</span><span class="st">&quot;google/timesfm-1.0-200m-pytorch&quot;</span>),</span>
<span id="cb214-10"><a href="#cb214-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb214-11"><a href="#cb214-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-12"><a href="#cb214-12" aria-hidden="true" tabindex="-1"></a>    forecasted_tfm <span class="op">=</span> tfm.forecast_on_df(</span>
<span id="cb214-13"><a href="#cb214-13" aria-hidden="true" tabindex="-1"></a>        inputs<span class="op">=</span>y_train,</span>
<span id="cb214-14"><a href="#cb214-14" aria-hidden="true" tabindex="-1"></a>        freq<span class="op">=</span><span class="st">&quot;D&quot;</span>,</span>
<span id="cb214-15"><a href="#cb214-15" aria-hidden="true" tabindex="-1"></a>        value_name<span class="op">=</span><span class="st">&quot;y&quot;</span>,</span>
<span id="cb214-16"><a href="#cb214-16" aria-hidden="true" tabindex="-1"></a>        num_jobs<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb214-17"><a href="#cb214-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb214-18"><a href="#cb214-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-19"><a href="#cb214-19" aria-hidden="true" tabindex="-1"></a>    calculate_scores_MLP_based(forecasted_tfm, y_test, y_train, distinctive_label<span class="op">=</span><span class="st">&quot;timesfm&quot;</span>)</span>
<span id="cb214-20"><a href="#cb214-20" aria-hidden="true" tabindex="-1"></a>    plot_multi_series_MLP_based(forecasted_tfm, labels, y_test, y_train, distinctive_label<span class="op">=</span><span class="st">&quot;timesfm&quot;</span>)</span></code></pre></div>
</div>
<div id="4027b161" class="cell code" data-execution_count="34">
<div class="sourceCode" id="cb215"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> use_timesfm_pretrained_for_pasta(y_train, y_test, labels):</span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>    tfm <span class="op">=</span> timesfm.TimesFm(</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a>        hparams<span class="op">=</span>timesfm.TimesFmHparams(</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a>            backend<span class="op">=</span><span class="st">&quot;cpu&quot;</span>,</span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a>            per_core_batch_size<span class="op">=</span><span class="dv">32</span>,</span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a>            horizon_len<span class="op">=</span><span class="dv">365</span>,</span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a>        ),</span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a>        checkpoint<span class="op">=</span>timesfm.TimesFmCheckpoint(</span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a>            huggingface_repo_id<span class="op">=</span><span class="st">&quot;google/timesfm-1.0-200m-pytorch&quot;</span>),</span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb215-11"><a href="#cb215-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-12"><a href="#cb215-12" aria-hidden="true" tabindex="-1"></a>    forecasted_tfm <span class="op">=</span> tfm.forecast_on_df(</span>
<span id="cb215-13"><a href="#cb215-13" aria-hidden="true" tabindex="-1"></a>        inputs<span class="op">=</span>y_train,</span>
<span id="cb215-14"><a href="#cb215-14" aria-hidden="true" tabindex="-1"></a>        freq<span class="op">=</span><span class="st">&quot;D&quot;</span>,</span>
<span id="cb215-15"><a href="#cb215-15" aria-hidden="true" tabindex="-1"></a>        value_name<span class="op">=</span><span class="st">&quot;y&quot;</span>,</span>
<span id="cb215-16"><a href="#cb215-16" aria-hidden="true" tabindex="-1"></a>        num_jobs<span class="op">=-</span><span class="dv">1</span>,</span>
<span id="cb215-17"><a href="#cb215-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb215-18"><a href="#cb215-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-19"><a href="#cb215-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print(forecasted_tfm)</span></span>
<span id="cb215-20"><a href="#cb215-20" aria-hidden="true" tabindex="-1"></a>    calculate_scores_MLP_based(forecasted_tfm, y_test, y_train, distinctive_label<span class="op">=</span><span class="st">&quot;timesfm&quot;</span>)</span>
<span id="cb215-21"><a href="#cb215-21" aria-hidden="true" tabindex="-1"></a>    plot_multi_series_MLP_based(forecasted_tfm, labels, y_test, y_train, distinctive_label<span class="op">=</span><span class="st">&quot;timesfm&quot;</span>)</span></code></pre></div>
</div>
<div id="e30f8305" class="cell code" data-execution_count="35">
<div class="sourceCode" id="cb216"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a>use_timesfm_pretrained_for_energy(y_train_energy_mlp_based, y_test_energy_mlp_based, energy_source_labels)</span></code></pre></div>
<div class="output display_data">
<div class="sourceCode" id="cb217"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;69bcdec0b62f48f79d8128eace02270a&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stdout">
<pre><code>Processing dataframe with multiple processes.
Finished preprocessing dataframe.
Finished forecasting.
R^2 score:  0.7361943262034896
MAE score:  30.107730047213565
MASE score:  3.240763700553279
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/3b8977b16d849158d5816eb393f8192fa9b539f2.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/abf11166fe5bc3bba77883b63a70a872ad9c5570.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/a471185bb64398c0265412c8e63e2d2098f2759f.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/3fab52b54b489785d13d2e722202e90cbb91e6d7.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/2c1ccbba84d68ed6be7a65dc135f7cb8c671e72f.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/e80a189f4145f126d7ef423592fab774b841044c.png" /></p>
</div>
</div>
<div id="aa8f8aff" class="cell code" data-execution_count="36">
<div class="sourceCode" id="cb219"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>use_timesfm_pretrained_for_pasta(y_train_pasta_mlp_based, y_test_pasta_mlp_based, pasta_labels)</span></code></pre></div>
<div class="output display_data">
<div class="sourceCode" id="cb220"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span><span class="dt">&quot;model_id&quot;</span><span class="fu">:</span><span class="st">&quot;980f82f51eb749aeaf195827ec7b5255&quot;</span><span class="fu">,</span><span class="dt">&quot;version_major&quot;</span><span class="fu">:</span><span class="dv">2</span><span class="fu">,</span><span class="dt">&quot;version_minor&quot;</span><span class="fu">:</span><span class="dv">0</span><span class="fu">}</span></span></code></pre></div>
</div>
<div class="output stream stdout">
<pre><code>Processing dataframe with multiple processes.
Finished preprocessing dataframe.
Finished forecasting.
R^2 score:  0.4156846723381301
MAE score:  38.56568553349743
MASE score:  0.8949516043434724
</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/39d576a0b1b62166d7ca5b2fbdd3e905936fea1e.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/137dac736f15895e937584de9d532128ceeaeef6.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/a544b00fc83ce90d124891e91bc0c05b0d4943ad.png" /></p>
</div>
<div class="output display_data">
<p><img
src="vertopal_fd98a61d89b44c108c4606501790d33c/bffbe0d1cd49be2d6e21baecc803b6488011f25d.png" /></p>
</div>
</div>
<div id="9efb9928" class="cell code">
<div class="sourceCode" id="cb222"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> nixtla <span class="im">import</span> NixtlaClient</span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utilsforecast.losses <span class="im">import</span> mae</span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>nixtla_client <span class="op">=</span> NixtlaClient(api_key <span class="op">=</span> <span class="st">&#39;&#39;</span>)</span></code></pre></div>
</div>
<div id="549d84c4" class="cell code" data-execution_count="38">
<div class="sourceCode" id="cb223"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> use_TimeGPT_for_energy(y_train_energy_mlp_based, y_test_energy_mlp_based):</span>
<span id="cb223-2"><a href="#cb223-2" aria-hidden="true" tabindex="-1"></a>    fcst_df <span class="op">=</span> nixtla_client.forecast(</span>
<span id="cb223-3"><a href="#cb223-3" aria-hidden="true" tabindex="-1"></a>        y_train_energy_mlp_based, </span>
<span id="cb223-4"><a href="#cb223-4" aria-hidden="true" tabindex="-1"></a>        h<span class="op">=</span><span class="dv">308</span>, </span>
<span id="cb223-5"><a href="#cb223-5" aria-hidden="true" tabindex="-1"></a>        level<span class="op">=</span>[<span class="dv">80</span>, <span class="dv">90</span>], </span>
<span id="cb223-6"><a href="#cb223-6" aria-hidden="true" tabindex="-1"></a>        freq<span class="op">=</span><span class="st">&#39;D&#39;</span>,</span>
<span id="cb223-7"><a href="#cb223-7" aria-hidden="true" tabindex="-1"></a>        finetune_steps<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb223-8"><a href="#cb223-8" aria-hidden="true" tabindex="-1"></a>        finetune_loss<span class="op">=</span><span class="st">&#39;mae&#39;</span>,</span>
<span id="cb223-9"><a href="#cb223-9" aria-hidden="true" tabindex="-1"></a>        time_col<span class="op">=</span><span class="st">&#39;ds&#39;</span>, </span>
<span id="cb223-10"><a href="#cb223-10" aria-hidden="true" tabindex="-1"></a>        target_col<span class="op">=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb223-11"><a href="#cb223-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-12"><a href="#cb223-12" aria-hidden="true" tabindex="-1"></a>    nixtla_client.plot(pd.concat([y_train_energy_mlp_based, y_test_energy_mlp_based]), fcst_df, level<span class="op">=</span>[<span class="dv">80</span>, <span class="dv">90</span>])</span>
<span id="cb223-13"><a href="#cb223-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb223-14"><a href="#cb223-14" aria-hidden="true" tabindex="-1"></a>    test <span class="op">=</span> y_test_energy_mlp_based.copy()</span>
<span id="cb223-15"><a href="#cb223-15" aria-hidden="true" tabindex="-1"></a>    test <span class="op">=</span> test.set_index(<span class="st">&quot;ds&quot;</span>)</span>
<span id="cb223-16"><a href="#cb223-16" aria-hidden="true" tabindex="-1"></a>    test[<span class="st">&#39;TimeGPT&#39;</span>] <span class="op">=</span> fcst_df[<span class="st">&#39;TimeGPT&#39;</span>].values</span>
<span id="cb223-17"><a href="#cb223-17" aria-hidden="true" tabindex="-1"></a>    evaluation <span class="op">=</span> mae(test, models<span class="op">=</span>[<span class="st">&#39;TimeGPT&#39;</span>], id_col<span class="op">=</span><span class="st">&#39;unique_id&#39;</span>, target_col<span class="op">=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb223-18"><a href="#cb223-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb223-19"><a href="#cb223-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(evaluation)</span></code></pre></div>
</div>
<div id="c93a9c71" class="cell code" data-execution_count="39">
<div class="sourceCode" id="cb224"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> use_TimeGPT_for_pasta(y_train_pasta_mlp_based, y_test_pasta_mlp_based):</span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>    fcst_df <span class="op">=</span> nixtla_client.forecast(</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>        y_train_pasta_mlp_based, </span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a>        h<span class="op">=</span><span class="dv">365</span>, </span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a>        level<span class="op">=</span>[<span class="dv">80</span>, <span class="dv">90</span>], </span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>        freq<span class="op">=</span><span class="st">&#39;D&#39;</span>,</span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>        finetune_steps<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a>        finetune_loss<span class="op">=</span><span class="st">&#39;mae&#39;</span>,</span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a>        time_col<span class="op">=</span><span class="st">&#39;ds&#39;</span>, </span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a>        target_col<span class="op">=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a>    nixtla_client.plot(pd.concat([y_train_pasta_mlp_based, y_test_pasta_mlp_based]), fcst_df, level<span class="op">=</span>[<span class="dv">80</span>, <span class="dv">90</span>])</span>
<span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a>    test <span class="op">=</span> y_test_pasta_mlp_based.copy()</span>
<span id="cb224-15"><a href="#cb224-15" aria-hidden="true" tabindex="-1"></a>    test <span class="op">=</span> test.set_index(<span class="st">&quot;ds&quot;</span>)</span>
<span id="cb224-16"><a href="#cb224-16" aria-hidden="true" tabindex="-1"></a>    test[<span class="st">&#39;TimeGPT&#39;</span>] <span class="op">=</span> fcst_df[<span class="st">&#39;TimeGPT&#39;</span>].values</span>
<span id="cb224-17"><a href="#cb224-17" aria-hidden="true" tabindex="-1"></a>    evaluation <span class="op">=</span> mae(test, models<span class="op">=</span>[<span class="st">&#39;TimeGPT&#39;</span>], id_col<span class="op">=</span><span class="st">&#39;unique_id&#39;</span>, target_col<span class="op">=</span><span class="st">&#39;y&#39;</span>)</span>
<span id="cb224-18"><a href="#cb224-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-19"><a href="#cb224-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(evaluation)</span></code></pre></div>
</div>
<div id="e4541041" class="cell code" data-execution_count="40">
<div class="sourceCode" id="cb225"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>use_TimeGPT_for_energy(y_train_energy_mlp_based, y_test_energy_mlp_based)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>WARNING:nixtla.nixtla_client:The specified horizon &quot;h&quot; exceeds the model horizon. This may lead to less accurate forecasts. Please consider using a smaller horizon.
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>  unique_id    TimeGPT
0      coal  27.822526
1       gas   9.188669
2     hydro   3.671135
3     other  98.763825
4     solar  44.245768
5      wind  46.906733
</code></pre>
</div>
</div>
<div id="17217aca" class="cell code" data-execution_count="41">
<div class="sourceCode" id="cb228"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>use_TimeGPT_for_pasta(y_train_pasta_mlp_based, y_test_pasta_mlp_based)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>WARNING:nixtla.nixtla_client:The specified horizon &quot;h&quot; exceeds the model horizon. This may lead to less accurate forecasts. Please consider using a smaller horizon.
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>  unique_id    TimeGPT
0  value_B1  79.964938
1  value_B2  64.871888
2  value_B3  20.630309
3  value_B4  31.592214
</code></pre>
</div>
</div>
</body>
</html>
